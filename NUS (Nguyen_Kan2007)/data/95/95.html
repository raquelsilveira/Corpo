<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<TITLE>D:\Paper\HTML\95</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="generator" content="pdftohtml 0.35beta">
<META name="date" content="2003-08-18T16:07:52+00:00">
</HEAD>
<BODY bgcolor="#A0A0A0" vlink="blue" link="blue">
<!-- Page 1 -->
<a name="1"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
	.ft0{font-size:24px;font-family:Helvetica;color:#000000;}
	.ft1{font-size:6px;font-family:Times;color:#000000;}
	.ft2{font-size:15px;font-family:Helvetica;color:#000000;}
	.ft3{font-size:12px;font-family:Helvetica;color:#000000;}
	.ft4{font-size:15px;font-family:Times;color:#000000;}
	.ft5{font-size:11px;font-family:Times;color:#000000;}
	.ft6{font-size:9px;font-family:Times;color:#000000;}
	.ft7{font-size:9px;font-family:Times;color:#000000;}
	.ft8{font-size:16px;font-family:Courier;color:#000000;}
	.ft9{font-size:11px;font-family:Times;color:#000000;}
	.ft10{font-size:11px;line-height:15px;font-family:Times;color:#000000;}
	.ft11{font-size:9px;line-height:13px;font-family:Times;color:#000000;}
-->
</STYLE>
<IMG width="918" height="1188" src="95001.png" alt="background image">
<DIV style="position:absolute;top:87;left:236"><nobr><span class="ft0"><b>Formally Deriving an STG Machine</b></span></nobr></DIV>
<DIV style="position:absolute;top:93;left:679"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:156;left:207"><nobr><span class="ft2">Alberto de la Encina</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:148"><nobr><span class="ft3">Departamento de Sistemas Inform ´aticos y</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:241"><nobr><span class="ft3">Programaci ´on</span></nobr></DIV>
<DIV style="position:absolute;top:203;left:144"><nobr><span class="ft3">Universidad Complutense de Madrid, Spain</span></nobr></DIV>
<DIV style="position:absolute;top:218;left:160"><nobr><span class="ft3">Avda. Complutense s/n, 28040 Madrid</span></nobr></DIV>
<DIV style="position:absolute;top:240;left:203"><nobr><span class="ft2">albertoe@sip.ucm.es</span></nobr></DIV>
<DIV style="position:absolute;top:156;left:573"><nobr><span class="ft2">Ricardo Pe ~na</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:487"><nobr><span class="ft3">Departamento de Sistemas Inform ´aticos y</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:580"><nobr><span class="ft3">Programaci ´on</span></nobr></DIV>
<DIV style="position:absolute;top:203;left:483"><nobr><span class="ft3">Universidad Complutense de Madrid, Spain</span></nobr></DIV>
<DIV style="position:absolute;top:218;left:499"><nobr><span class="ft3">Avda. Complutense s/n, 28040 Madrid</span></nobr></DIV>
<DIV style="position:absolute;top:240;left:548"><nobr><span class="ft2">ricardo@sip.ucm.es</span></nobr></DIV>
<DIV style="position:absolute;top:312;left:81"><nobr><span class="ft4"><b>ABSTRACT</b></span></nobr></DIV>
<DIV style="position:absolute;top:334;left:81"><nobr><span class="ft10">Starting from P. Sestoft semantics for lazy evaluation, we<br>define a new semantics in which normal forms consist of vari-<br>ables pointing to lambdas or constructions. This is in accor-<br>dance with the more recent changes in the Spineless Tagless<br>G-machine (STG) machine, where constructions only ap-<br>pear in closures (lambdas only appeared in closures already<br>in previous versions). We prove the equivalence between the<br>new semantics and Sestoft's. Then, a sequence of STG ma-<br>chines are derived, formally proving the correctness of each<br>derivation. The last machine consists of a few imperative<br>instructions and its distance to a conventional language is<br>minimal.</span></nobr></DIV>
<DIV style="position:absolute;top:515;left:94"><nobr><span class="ft5">The paper also discusses the differences between the final</span></nobr></DIV>
<DIV style="position:absolute;top:530;left:81"><nobr><span class="ft10">machine and the actual STG machine implemented in the<br>Glasgow Haskell Compiler.</span></nobr></DIV>
<DIV style="position:absolute;top:592;left:81"><nobr><span class="ft4"><b>Categories and Subject Descriptors</b></span></nobr></DIV>
<DIV style="position:absolute;top:614;left:81"><nobr><span class="ft10">D.3.1 [Programming Languages]: Formal Definitions and<br>Theory--semantics, syntax ; D.3.2 [Programming Lan-<br>guages]: Language Classifications--applicative (functional)<br>languages; D.3.4 [Programming Languages]: Processors--<br>code generation, compilers; F.3.2 [Logics and meanings<br>of programs]: Semantics of Programming Languages--op-<br>erational semantics</span></nobr></DIV>
<DIV style="position:absolute;top:751;left:81"><nobr><span class="ft4"><b>General Terms</b></span></nobr></DIV>
<DIV style="position:absolute;top:773;left:81"><nobr><span class="ft5">Theory, Languages, Verification</span></nobr></DIV>
<DIV style="position:absolute;top:820;left:81"><nobr><span class="ft4"><b>Keywords</b></span></nobr></DIV>
<DIV style="position:absolute;top:842;left:81"><nobr><span class="ft10">Functional programming, abstract machines, operational se-<br>mantics, compiler verification</span></nobr></DIV>
<DIV style="position:absolute;top:892;left:81"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:894;left:88"><nobr><span class="ft5">Work partially supported by the Spanish project TIC 2000-</span></nobr></DIV>
<DIV style="position:absolute;top:906;left:81"><nobr><span class="ft5">0738.</span></nobr></DIV>
<DIV style="position:absolute;top:977;left:81"><nobr><span class="ft11">Permission to make digital or hard copies of all or part of this work for<br>personal or classroom use is granted without fee provided that copies are<br>not made or distributed for profit or commercial advantage and that copies<br>bear this notice and the full citation on the first page. To copy otherwise, to<br>republish, to post on servers or to redistribute to lists, requires prior specific<br>permission and/or a fee.<br><i>PPDP'03, </i>August 27­29, 2003, Uppsala, Sweden.<br>Copyright 2003 ACM 1-58113-705-2/03/0008 ...</span></nobr></DIV>
<DIV style="position:absolute;top:1068;left:315"><nobr><span class="ft5">$</span></nobr></DIV>
<DIV style="position:absolute;top:1071;left:322"><nobr><span class="ft6">5.00.</span></nobr></DIV>
<DIV style="position:absolute;top:312;left:475"><nobr><span class="ft4"><b>1.</b></span></nobr></DIV>
<DIV style="position:absolute;top:312;left:507"><nobr><span class="ft4"><b>INTRODUCTION</b></span></nobr></DIV>
<DIV style="position:absolute;top:344;left:489"><nobr><span class="ft5">The Spineless Tagless G-machine (STG) [6] is at the heart</span></nobr></DIV>
<DIV style="position:absolute;top:359;left:475"><nobr><span class="ft10">of the Glasgow Haskell Compiler (GHC) [7] which is perhaps<br>the Haskell compiler generating the most efficient code. For<br>a description of Haskell language see [8]. Part of the secret<br>for that is the set of analysis and transformations carried<br>out at the intermediate representation level. Another part<br>of the explanation is the efficient design and implementation<br>of the STG machine.</span></nobr></DIV>
<DIV style="position:absolute;top:464;left:489"><nobr><span class="ft5">A high level description of the STG can be found in [6].</span></nobr></DIV>
<DIV style="position:absolute;top:479;left:475"><nobr><span class="ft10">If the reader is interested in a more detailed view, then the<br>only available information is the Haskell code of GHC (about<br>80.000 lines, 12.000 of which are devoted to the implemen-<br>tation of the STG machine) and the C code of its different<br>runtime systems (more than 40.000 lines)[1].</span></nobr></DIV>
<DIV style="position:absolute;top:555;left:489"><nobr><span class="ft5">In this paper we provide a step-by-step derivation of the</span></nobr></DIV>
<DIV style="position:absolute;top:570;left:475"><nobr><span class="ft10">STG machine, starting from a description higher-level than<br>that of [6] and arriving at a description lower-level than that.</span></nobr></DIV>
<DIV style="position:absolute;top:600;left:489"><nobr><span class="ft5">Our starting point is a commonly accepted operational</span></nobr></DIV>
<DIV style="position:absolute;top:615;left:475"><nobr><span class="ft10">semantics for lazy evaluation provided by Peter Sestoft in<br>[10] as an improvement of John Launchbury's well-known<br>definition in [4]. Then, we present the following refinements:</span></nobr></DIV>
<DIV style="position:absolute;top:691;left:491"><nobr><span class="ft5">1. A new operational semantics, which we call semantics</span></nobr></DIV>
<DIV style="position:absolute;top:706;left:509"><nobr><span class="ft10">S3 --acknowledging that semantics 1 and 2 were de-<br>fined by Mountjoy in a previous attempt [5]--, where<br>normal forms may appear only in bindings.</span></nobr></DIV>
<DIV style="position:absolute;top:781;left:491"><nobr><span class="ft5">2. A first machine, called STG-1, derived from S3 in</span></nobr></DIV>
<DIV style="position:absolute;top:796;left:509"><nobr><span class="ft10">which explicit replacement of pointers for variables is<br>done in expressions.</span></nobr></DIV>
<DIV style="position:absolute;top:855;left:491"><nobr><span class="ft5">3. A second machine STG-2 introducing environments in</span></nobr></DIV>
<DIV style="position:absolute;top:870;left:509"><nobr><span class="ft10">closures, case alternatives, and in the control expres-<br>sion.</span></nobr></DIV>
<DIV style="position:absolute;top:930;left:491"><nobr><span class="ft5">4. A third machine, called ISTG (I stands for imperative)</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:509"><nobr><span class="ft10">with a very small set of elementary instructions, each<br>one very easy to be implemented in a conventional<br>language such as C.</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:491"><nobr><span class="ft5">5. A translation from the language of STG-2 to the lan-</span></nobr></DIV>
<DIV style="position:absolute;top:1034;left:509"><nobr><span class="ft10">guage of ISTG in which the data structures of STG-2<br>are represented (or implemented) by the ISTG data<br>structures.</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">102</span></nobr></DIV>
</DIV>
<!-- Page 2 -->
<a name="2"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
	.ft12{font-size:15px;line-height:20px;font-family:Times;color:#000000;}
-->
</STYLE>
<IMG width="918" height="1188" src="95002.png" alt="background image">
<DIV style="position:absolute;top:90;left:87"><nobr><span class="ft5">e  x</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:285"><nobr><span class="ft5">-- variable</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:112"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:135"><nobr><span class="ft5">x.e</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:285"><nobr><span class="ft5">-- lambda abstraction</span></nobr></DIV>
<DIV style="position:absolute;top:120;left:112"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:120;left:135"><nobr><span class="ft5">e x</span></nobr></DIV>
<DIV style="position:absolute;top:120;left:285"><nobr><span class="ft5">-- application</span></nobr></DIV>
<DIV style="position:absolute;top:135;left:112"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:135;left:135"><nobr><span class="ft5">letrec x</span></nobr></DIV>
<DIV style="position:absolute;top:141;left:186"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:135;left:194"><nobr><span class="ft5">= e</span></nobr></DIV>
<DIV style="position:absolute;top:141;left:215"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:135;left:225"><nobr><span class="ft5">in e</span></nobr></DIV>
<DIV style="position:absolute;top:135;left:285"><nobr><span class="ft5">-- recursive let</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:112"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:135"><nobr><span class="ft5">C x</span></nobr></DIV>
<DIV style="position:absolute;top:156;left:158"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:285"><nobr><span class="ft5">-- constructor application</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:112"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:135"><nobr><span class="ft5">case e of C</span></nobr></DIV>
<DIV style="position:absolute;top:172;left:207"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:217"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:172;left:225"><nobr><span class="ft1">ij</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:238"><nobr><span class="ft5"> e</span></nobr></DIV>
<DIV style="position:absolute;top:172;left:262"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:285"><nobr><span class="ft5">-- case expression</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:101"><nobr><span class="ft5">Figure 1: Launchbury's normalized -calculus</span></nobr></DIV>
<DIV style="position:absolute;top:275;left:94"><nobr><span class="ft5">At each refinement, a formal proof of the soundness and</span></nobr></DIV>
<DIV style="position:absolute;top:290;left:81"><nobr><span class="ft10">completeness of the lower level with respect to the upper<br>one is carried out</span></nobr></DIV>
<DIV style="position:absolute;top:303;left:189"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:305;left:199"><nobr><span class="ft5">. In the end, the final implementation is</span></nobr></DIV>
<DIV style="position:absolute;top:320;left:81"><nobr><span class="ft10">shown correct with respect to Sestoft's operational seman-<br>tics.</span></nobr></DIV>
<DIV style="position:absolute;top:350;left:94"><nobr><span class="ft5">The main contribution of the work is showing that an ef-</span></nobr></DIV>
<DIV style="position:absolute;top:365;left:81"><nobr><span class="ft10">ficient machine such as STG can be presented, understood,<br>and formally reasoned about at different levels of abstrac-<br>tion. Also, there are some differences between the machine<br>we arrive at and the actual STG machine implemented in<br>the Glasgow Haskell Compiler. We argue that some design<br>decisions in the actual STG machine are not properly justi-<br>fied.</span></nobr></DIV>
<DIV style="position:absolute;top:471;left:94"><nobr><span class="ft5">The plan of the paper is as follows: after this introduc-</span></nobr></DIV>
<DIV style="position:absolute;top:486;left:81"><nobr><span class="ft10">tion, in Section 2, a new language called FUN is introduced<br>and the semantics S3 for this language is defined. Two the-<br>orems relating Launchbury's original language and seman-<br>tics to the new ones are presented. Section 3 defines the<br>two machines STG-1 and STG-2. Some propositions show<br>the consistency between both machines and the correctness<br>and completeness of STG-1 with respect to S3, eventhough<br>the latter creates more closures in the heap and produces<br>different (but equivalent) normal forms. Section 4 defines<br>machine ISTG and Section 5 defines the translation from<br>STG-2 expressions to ISTG instructions. Two invariants are<br>proved which show the correctness of the translation. Sec-<br>tion 6 discusses the differences between our translation and<br>the actual implementation done by GHC. Finally, Section 7<br>concludes.</span></nobr></DIV>
<DIV style="position:absolute;top:733;left:81"><nobr><span class="ft4"><b>2.</b></span></nobr></DIV>
<DIV style="position:absolute;top:733;left:112"><nobr><span class="ft12"><b>A NEW SEMANTICS FOR LAZY EVAL-<br>UATION</b></span></nobr></DIV>
<DIV style="position:absolute;top:773;left:94"><nobr><span class="ft5">We begin by reviewing the language and semantics given</span></nobr></DIV>
<DIV style="position:absolute;top:788;left:81"><nobr><span class="ft10">by Sestoft as an improvement to Launchbury's semantics.<br>Both share the language given in Figure 1 where A</span></nobr></DIV>
<DIV style="position:absolute;top:808;left:409"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:803;left:421"><nobr><span class="ft5">de-</span></nobr></DIV>
<DIV style="position:absolute;top:818;left:81"><nobr><span class="ft5">notes a vector A</span></nobr></DIV>
<DIV style="position:absolute;top:823;left:178"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:818;left:184"><nobr><span class="ft5">, . . . , A</span></nobr></DIV>
<DIV style="position:absolute;top:823;left:225"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:818;left:236"><nobr><span class="ft5">of subscripted entities. It is a nor-</span></nobr></DIV>
<DIV style="position:absolute;top:833;left:81"><nobr><span class="ft10">malized -calculus, extended with recursive let, constructor<br>applications and case expressions. Sestoft's normalization<br>process forces constructor applications to be saturated and<br>all applications to only have variables as arguments. Weak<br>head normal forms are either lambda abstractions or con-<br>structions. Throughout this section, w will denote (weak<br>head) normal forms.</span></nobr></DIV>
<DIV style="position:absolute;top:939;left:94"><nobr><span class="ft5">Sestoft's semantic rules are given in Figure 2. There, a</span></nobr></DIV>
<DIV style="position:absolute;top:954;left:81"><nobr><span class="ft5">judgement  : e </span></nobr></DIV>
<DIV style="position:absolute;top:959;left:192"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:954;left:206"><nobr><span class="ft5"> : w denotes that expression e, with</span></nobr></DIV>
<DIV style="position:absolute;top:969;left:81"><nobr><span class="ft10">its free variables bound in heap , reduces to normal form<br>w and produces the final heap . When fresh pointers are<br>created, freshness is understood w.r.t. (dom )  A, where<br>A contains the addresses of the closures under evaluation</span></nobr></DIV>
<DIV style="position:absolute;top:1037;left:81"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:88"><nobr><span class="ft5">The</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:126"><nobr><span class="ft5">details</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:180"><nobr><span class="ft5">of</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:206"><nobr><span class="ft5">the</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:240"><nobr><span class="ft5">proofs</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:292"><nobr><span class="ft5">can</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:328"><nobr><span class="ft5">be</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:357"><nobr><span class="ft5">found</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:406"><nobr><span class="ft5">in</span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:432"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:81"><nobr><span class="ft5">technical</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:152"><nobr><span class="ft5">report</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:208"><nobr><span class="ft5">at</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:238"><nobr><span class="ft5">one</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:277"><nobr><span class="ft5">of</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:307"><nobr><span class="ft5">the</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:344"><nobr><span class="ft5">author's</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:412"><nobr><span class="ft5">page</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:81"><nobr><span class="ft5">http://dalila.sip.ucm.es/~albertoe.</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:571"><nobr><span class="ft5"> : x.e </span></nobr></DIV>
<DIV style="position:absolute;top:96;left:629"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:642"><nobr><span class="ft5"> : x.e</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:786"><nobr><span class="ft5">Lam</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:572"><nobr><span class="ft5"> : C p</span></nobr></DIV>
<DIV style="position:absolute;top:119;left:612"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:621"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:119;left:629"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:642"><nobr><span class="ft5"> : C p</span></nobr></DIV>
<DIV style="position:absolute;top:119;left:682"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:786"><nobr><span class="ft5">Cons</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:510"><nobr><span class="ft5"> : e </span></nobr></DIV>
<DIV style="position:absolute;top:143;left:549"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:562"><nobr><span class="ft5"> : x.e</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:629"><nobr><span class="ft5"> : e [p/x] </span></nobr></DIV>
<DIV style="position:absolute;top:143;left:704"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:717"><nobr><span class="ft5"> : w</span></nobr></DIV>
<DIV style="position:absolute;top:157;left:582"><nobr><span class="ft5"> : e p </span></nobr></DIV>
<DIV style="position:absolute;top:162;left:632"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:157;left:645"><nobr><span class="ft5"> : w</span></nobr></DIV>
<DIV style="position:absolute;top:157;left:786"><nobr><span class="ft5">App</span></nobr></DIV>
<DIV style="position:absolute;top:179;left:575"><nobr><span class="ft5"> : e </span></nobr></DIV>
<DIV style="position:absolute;top:185;left:613"><nobr><span class="ft1">A{p}</span></nobr></DIV>
<DIV style="position:absolute;top:179;left:651"><nobr><span class="ft5"> : w</span></nobr></DIV>
<DIV style="position:absolute;top:200;left:527"><nobr><span class="ft5">  [p  e] : p </span></nobr></DIV>
<DIV style="position:absolute;top:205;left:624"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:200;left:637"><nobr><span class="ft5">  [p  w] : w</span></nobr></DIV>
<DIV style="position:absolute;top:200;left:786"><nobr><span class="ft5">Var</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:507"><nobr><span class="ft5">  [p</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:542"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:550"><nobr><span class="ft5"> ^</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:568"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:574"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:579"><nobr><span class="ft5">] : ^</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:594"><nobr><span class="ft5">e </span></nobr></DIV>
<DIV style="position:absolute;top:231;left:613"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:626"><nobr><span class="ft5"> : w</span></nobr></DIV>
<DIV style="position:absolute;top:245;left:487"><nobr><span class="ft5"> : letrec x</span></nobr></DIV>
<DIV style="position:absolute;top:250;left:558"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:245;left:567"><nobr><span class="ft5">= e</span></nobr></DIV>
<DIV style="position:absolute;top:250;left:588"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:245;left:597"><nobr><span class="ft5">in e </span></nobr></DIV>
<DIV style="position:absolute;top:250;left:634"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:245;left:646"><nobr><span class="ft5"> : w where p</span></nobr></DIV>
<DIV style="position:absolute;top:241;left:734"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:236;left:743"><nobr><span class="ft5">fresh Letrec</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:496"><nobr><span class="ft5"> : e </span></nobr></DIV>
<DIV style="position:absolute;top:276;left:537"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:550"><nobr><span class="ft5"> : C</span></nobr></DIV>
<DIV style="position:absolute;top:276;left:583"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:595"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:276;left:602"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:621"><nobr><span class="ft5"> : e</span></nobr></DIV>
<DIV style="position:absolute;top:276;left:651"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:658"><nobr><span class="ft5">[p</span></nobr></DIV>
<DIV style="position:absolute;top:276;left:668"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:674"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:276;left:689"><nobr><span class="ft1">kj</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:701"><nobr><span class="ft5">] </span></nobr></DIV>
<DIV style="position:absolute;top:276;left:717"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:730"><nobr><span class="ft5"> : w</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:524"><nobr><span class="ft5"> : case e of C</span></nobr></DIV>
<DIV style="position:absolute;top:298;left:617"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:627"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:298;left:634"><nobr><span class="ft1">ij</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:648"><nobr><span class="ft5"> e</span></nobr></DIV>
<DIV style="position:absolute;top:298;left:672"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:681"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:298;left:689"><nobr><span class="ft1">A</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:702"><nobr><span class="ft5"> : w</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:786"><nobr><span class="ft5">Case</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:527"><nobr><span class="ft5">Figure 2: Sestoft's natural semantics</span></nobr></DIV>
<DIV style="position:absolute;top:376;left:475"><nobr><span class="ft5">(see rule Var). The notation ^</span></nobr></DIV>
<DIV style="position:absolute;top:376;left:652"><nobr><span class="ft5">e in rule Letrec means the re-</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:475"><nobr><span class="ft5">placement of the variables x</span></nobr></DIV>
<DIV style="position:absolute;top:396;left:646"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:655"><nobr><span class="ft5">by the fresh pointers p</span></nobr></DIV>
<DIV style="position:absolute;top:396;left:792"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:797"><nobr><span class="ft5">. This</span></nobr></DIV>
<DIV style="position:absolute;top:406;left:475"><nobr><span class="ft10">is the only rule where new closures are created and added<br>to the heap. We use the term pointers to refer to dynam-<br>ically created free variables, bounded to expressions in the<br>heap, and the term variables to refer to (lambda-bound, let-<br>bound or case-bound) program variables. We consistently<br>use p, p</span></nobr></DIV>
<DIV style="position:absolute;top:487;left:520"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:482;left:525"><nobr><span class="ft5">, . . . to denote free variables and x, y, . . . to denote</span></nobr></DIV>
<DIV style="position:absolute;top:497;left:475"><nobr><span class="ft5">program variables.</span></nobr></DIV>
<DIV style="position:absolute;top:512;left:489"><nobr><span class="ft5">J. Mountjoy's [5] had the idea of changing Launchbury-</span></nobr></DIV>
<DIV style="position:absolute;top:527;left:475"><nobr><span class="ft10">Sestoft's language and semantics in order to get closer to the<br>STG language, and then to derive the STG machine from<br>the new semantics.</span></nobr></DIV>
<DIV style="position:absolute;top:572;left:489"><nobr><span class="ft5">He developed two different semantics: In the first one,</span></nobr></DIV>
<DIV style="position:absolute;top:587;left:475"><nobr><span class="ft10">which we call semantics S1, the main change was that nor-<br>mal forms were either constructions (as they were in Ses-<br>toft's semantics) or variables pointing to closures containing<br>-abstractions, instead of just -abstractions. The reason<br>for this was to forbid a -abstraction in the control expres-<br>sion as it happens in the STG machine. Another change<br>was to force applications to have the form x x</span></nobr></DIV>
<DIV style="position:absolute;top:683;left:750"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:677;left:757"><nobr><span class="ft5">, i.e. consist-</span></nobr></DIV>
<DIV style="position:absolute;top:692;left:475"><nobr><span class="ft10">ing of a variable in the functional part. This is also what<br>the STG language requires. These changes forced Mountjoy<br>to modify the source language and to define a normaliza-<br>tion from Launchbury's language to the new one. Mountjoy<br>proved that the normalization did not change the normal<br>forms arrived at by both semantics.</span></nobr></DIV>
<DIV style="position:absolute;top:783;left:489"><nobr><span class="ft5">The second semantics, which we call semantics S2, forced</span></nobr></DIV>
<DIV style="position:absolute;top:798;left:475"><nobr><span class="ft10">applications to be done at once to n arguments instead of<br>doing it one by one. Correspondingly, -abstractions were<br>allowed to have several arguments. This is exactly what<br>the STG machine requires. Semantics S2 was informally<br>derived and contained some mistakes. In particular, (cf. [5,<br>pag. 171]) rule App</span></nobr></DIV>
<DIV style="position:absolute;top:879;left:599"><nobr><span class="ft1">M</span></nobr></DIV>
<DIV style="position:absolute;top:873;left:616"><nobr><span class="ft5">makes a -abstraction to appear in</span></nobr></DIV>
<DIV style="position:absolute;top:888;left:475"><nobr><span class="ft10">the control expression, in contradiction with the desire of<br>having -abstractions only in the heap.</span></nobr></DIV>
<DIV style="position:absolute;top:918;left:489"><nobr><span class="ft5">Completing and correcting Mountjoy's work we have de-</span></nobr></DIV>
<DIV style="position:absolute;top:933;left:475"><nobr><span class="ft10">fined a new semantics S3 in which the main changes in the<br>source language w.r.t. Mountjoy's are the following:</span></nobr></DIV>
<DIV style="position:absolute;top:974;left:491"><nobr><span class="ft5">1. We force constructor applications to appear only in</span></nobr></DIV>
<DIV style="position:absolute;top:989;left:509"><nobr><span class="ft10">bindings, i.e. in heap closures. Correspondingly, nor-<br>mal forms are variables pointing to either -abstractions<br>or constructions. We will use the term lambda forms to<br>refer to -abstractions or constructions alike. The mo-<br>tivation for this decision is to generate more efficient<br>code as it will be seen in Section 5.1.</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">103</span></nobr></DIV>
</DIV>
<!-- Page 3 -->
<a name="3"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
	.ft13{font-size:8px;font-family:Times;color:#000000;}
-->
</STYLE>
<IMG width="918" height="1188" src="95003.png" alt="background image">
<DIV style="position:absolute;top:90;left:87"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:117"><nobr><span class="ft5"> e x</span></nobr></DIV>
<DIV style="position:absolute;top:96;left:163"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:277"><nobr><span class="ft5">-- n &gt; 0, application</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:122"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:145"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:277"><nobr><span class="ft5">-- variable</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:122"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:145"><nobr><span class="ft5">letrec x</span></nobr></DIV>
<DIV style="position:absolute;top:127;left:196"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:204"><nobr><span class="ft5">= lf</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:230"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:239"><nobr><span class="ft5">in e -- recursive let</span></nobr></DIV>
<DIV style="position:absolute;top:139;left:122"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:139;left:145"><nobr><span class="ft5">case e of alt</span></nobr></DIV>
<DIV style="position:absolute;top:144;left:224"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:139;left:277"><nobr><span class="ft5">-- case expression</span></nobr></DIV>
<DIV style="position:absolute;top:154;left:87"><nobr><span class="ft5">alt</span></nobr></DIV>
<DIV style="position:absolute;top:154;left:117"><nobr><span class="ft5"> C x</span></nobr></DIV>
<DIV style="position:absolute;top:159;left:168"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:154;left:178"><nobr><span class="ft5"> e</span></nobr></DIV>
<DIV style="position:absolute;top:154;left:277"><nobr><span class="ft5">-- case alternative</span></nobr></DIV>
<DIV style="position:absolute;top:184;left:87"><nobr><span class="ft5">lf</span></nobr></DIV>
<DIV style="position:absolute;top:184;left:117"><nobr><span class="ft5">  x</span></nobr></DIV>
<DIV style="position:absolute;top:189;left:165"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:184;left:177"><nobr><span class="ft5">.e</span></nobr></DIV>
<DIV style="position:absolute;top:184;left:277"><nobr><span class="ft5">-- n &gt; 0, lambda abstraction</span></nobr></DIV>
<DIV style="position:absolute;top:199;left:122"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:199;left:145"><nobr><span class="ft5">C x</span></nobr></DIV>
<DIV style="position:absolute;top:204;left:168"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:199;left:277"><nobr><span class="ft5">-- constructor application</span></nobr></DIV>
<DIV style="position:absolute;top:214;left:122"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:214;left:145"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:214;left:277"><nobr><span class="ft5">-- expression</span></nobr></DIV>
<DIV style="position:absolute;top:253;left:172"><nobr><span class="ft5">Figure 3: Language FUN</span></nobr></DIV>
<DIV style="position:absolute;top:310;left:97"><nobr><span class="ft5">2. We relax applications to have the form e x</span></nobr></DIV>
<DIV style="position:absolute;top:315;left:362"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:310;left:375"><nobr><span class="ft5">, where e is</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:114"><nobr><span class="ft10">an arbitrary expression (excluding, of course, lambda<br>forms). The initial motivation for this was not to in-<br>troduce unjustified restrictions. In the conclusions we<br>discuss that the generated code is also more efficient<br>than the one produced by restricting applications to<br>be of the form x x</span></nobr></DIV>
<DIV style="position:absolute;top:406;left:226"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:400;left:238"><nobr><span class="ft5">.</span></nobr></DIV>
<DIV style="position:absolute;top:438;left:81"><nobr><span class="ft10">Additionally, our starting point is Sestoft's semantics in-<br>stead of Launchbury's. The main difference is that Sestoft<br>substitutes fresh pointers for program variables in rule Letrec<br>while Launchbury substitutes fresh variables for all bound<br>variables in rule Var instead.</span></nobr></DIV>
<DIV style="position:absolute;top:514;left:94"><nobr><span class="ft5">The syntax of the language, called FUN, is shown in Fig-</span></nobr></DIV>
<DIV style="position:absolute;top:529;left:81"><nobr><span class="ft10">ure 3. Notice that applications are done to n arguments<br>at once, being e x</span></nobr></DIV>
<DIV style="position:absolute;top:549;left:193"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:212"><nobr><span class="ft5">an abbreviation of (. . . (e x</span></nobr></DIV>
<DIV style="position:absolute;top:549;left:379"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:385"><nobr><span class="ft5">) . . .) x</span></nobr></DIV>
<DIV style="position:absolute;top:549;left:428"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:436"><nobr><span class="ft5">,</span></nobr></DIV>
<DIV style="position:absolute;top:559;left:81"><nobr><span class="ft10">and that consequently -abstractions may have several ar-<br>guments. Its operational semantics, called S3 is given in<br>Figure 4. For simplicity, we have eliminated the set A of<br>pending updates appearing in Sestoft's semantics. This set<br>is not strictly needed provided that the fresh name genera-<br>tor for pointers does not repeat previously generated names<br>and provided that pointer's names are always distinguish-<br>able from program variables. In rule Case</span></nobr></DIV>
<DIV style="position:absolute;top:669;left:337"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:664;left:350"><nobr><span class="ft5">, expression e</span></nobr></DIV>
<DIV style="position:absolute;top:670;left:432"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:679;left:81"><nobr><span class="ft5">is the righthand side expression of the alternative alt</span></nobr></DIV>
<DIV style="position:absolute;top:685;left:399"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:679;left:406"><nobr><span class="ft5">. The</span></nobr></DIV>
<DIV style="position:absolute;top:694;left:81"><nobr><span class="ft10">notation [p  e] highlights the fact that (p  e)  ,<br>and   [p  e] means the disjoint union of  and (p  e).<br>Please notice that this notation may not coincide with other<br>notations in which  and [p  e] denote different heaps.<br>Finally notice that, besides rule Letrec</span></nobr></DIV>
<DIV style="position:absolute;top:760;left:320"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:755;left:333"><nobr><span class="ft5">, also rule App</span></nobr></DIV>
<DIV style="position:absolute;top:762;left:426"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:770;left:81"><nobr><span class="ft5">creates closures in the heap.</span></nobr></DIV>
<DIV style="position:absolute;top:785;left:94"><nobr><span class="ft5">Language FUN is at least as expressive as Launchbury's</span></nobr></DIV>
<DIV style="position:absolute;top:800;left:81"><nobr><span class="ft10">-calculus. The following normalization function transforms<br>any Launchbury's expression into a semantically equivalent<br>FUN expression.</span></nobr></DIV>
<DIV style="position:absolute;top:877;left:96"><nobr><span class="ft5">Definition 1. We define the normalization function N :</span></nobr></DIV>
<DIV style="position:absolute;top:892;left:81"><nobr><span class="ft5">Launch  FUN:</span></nobr></DIV>
<DIV style="position:absolute;top:931;left:87"><nobr><span class="ft5">N x</span></nobr></DIV>
<DIV style="position:absolute;top:926;left:248"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:931;left:250"><nobr><span class="ft5">= x</span></nobr></DIV>
<DIV style="position:absolute;top:952;left:87"><nobr><span class="ft5">N (e x)</span></nobr></DIV>
<DIV style="position:absolute;top:947;left:248"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:952;left:250"><nobr><span class="ft5">= (N e) x</span></nobr></DIV>
<DIV style="position:absolute;top:973;left:87"><nobr><span class="ft5">N ( x.e)</span></nobr></DIV>
<DIV style="position:absolute;top:968;left:248"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:973;left:250"><nobr><span class="ft5">= letrec y = N ( x.e) in y</span></nobr></DIV>
<DIV style="position:absolute;top:988;left:299"><nobr><span class="ft5">, y fresh</span></nobr></DIV>
<DIV style="position:absolute;top:1009;left:87"><nobr><span class="ft5">N (C x</span></nobr></DIV>
<DIV style="position:absolute;top:1014;left:130"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1009;left:135"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:1004;left:248"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:1009;left:250"><nobr><span class="ft5">= letrec y = C x</span></nobr></DIV>
<DIV style="position:absolute;top:1014;left:368"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1009;left:378"><nobr><span class="ft5">in y</span></nobr></DIV>
<DIV style="position:absolute;top:1024;left:299"><nobr><span class="ft5">, y fresh</span></nobr></DIV>
<DIV style="position:absolute;top:1045;left:87"><nobr><span class="ft5">N (letrec x</span></nobr></DIV>
<DIV style="position:absolute;top:1050;left:158"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1045;left:172"><nobr><span class="ft5">= e</span></nobr></DIV>
<DIV style="position:absolute;top:1050;left:197"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:1045;left:214"><nobr><span class="ft5">in e)</span></nobr></DIV>
<DIV style="position:absolute;top:1040;left:248"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:1045;left:250"><nobr><span class="ft5">= letrec x</span></nobr></DIV>
<DIV style="position:absolute;top:1050;left:318"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1045;left:331"><nobr><span class="ft5">= N e</span></nobr></DIV>
<DIV style="position:absolute;top:1050;left:377"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1040;left:382"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:1045;left:394"><nobr><span class="ft5">in N e</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:87"><nobr><span class="ft5">N (case e of C</span></nobr></DIV>
<DIV style="position:absolute;top:1071;left:180"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:189"><nobr><span class="ft5">y</span></nobr></DIV>
<DIV style="position:absolute;top:1071;left:196"><nobr><span class="ft1">ij</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:210"><nobr><span class="ft5"> e</span></nobr></DIV>
<DIV style="position:absolute;top:1071;left:234"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:239"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:1061;left:248"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:250"><nobr><span class="ft5">= case N e of C</span></nobr></DIV>
<DIV style="position:absolute;top:1071;left:354"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:363"><nobr><span class="ft5">y</span></nobr></DIV>
<DIV style="position:absolute;top:1071;left:370"><nobr><span class="ft1">ij</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:384"><nobr><span class="ft5"> N e</span></nobr></DIV>
<DIV style="position:absolute;top:1071;left:422"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:84;left:489"><nobr><span class="ft5">N , N : Launch  FUN:</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:513"><nobr><span class="ft5">N (C x</span></nobr></DIV>
<DIV style="position:absolute;top:119;left:562"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:574"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:108;left:602"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:605"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:641"><nobr><span class="ft5">C x</span></nobr></DIV>
<DIV style="position:absolute;top:119;left:664"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:513"><nobr><span class="ft5">N e</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:602"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:605"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:641"><nobr><span class="ft5">N</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:665"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:727"><nobr><span class="ft5">, e = C x</span></nobr></DIV>
<DIV style="position:absolute;top:140;left:784"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:155;left:513"><nobr><span class="ft5">N</span></nobr></DIV>
<DIV style="position:absolute;top:155;left:537"><nobr><span class="ft5">( x.e)</span></nobr></DIV>
<DIV style="position:absolute;top:150;left:602"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:155;left:605"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:155;left:641"><nobr><span class="ft5"> x.N</span></nobr></DIV>
<DIV style="position:absolute;top:155;left:689"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:513"><nobr><span class="ft5">N</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:537"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:171;left:602"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:605"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:641"><nobr><span class="ft5">N e</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:728"><nobr><span class="ft5">, e =  x.e</span></nobr></DIV>
<DIV style="position:absolute;top:203;left:489"><nobr><span class="ft5">The following proposition prove that the normalization</span></nobr></DIV>
<DIV style="position:absolute;top:218;left:475"><nobr><span class="ft5">functions are well defined.</span></nobr></DIV>
<DIV style="position:absolute;top:245;left:490"><nobr><span class="ft5">Proposition 1.</span></nobr></DIV>
<DIV style="position:absolute;top:267;left:491"><nobr><span class="ft5">1. Let e  Launch then N e  FUN</span></nobr></DIV>
<DIV style="position:absolute;top:292;left:491"><nobr><span class="ft5">2. Let e  lf then N e  lf</span></nobr></DIV>
<DIV style="position:absolute;top:316;left:491"><nobr><span class="ft5">3. Let e = x.e and e = C x</span></nobr></DIV>
<DIV style="position:absolute;top:322;left:668"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:316;left:678"><nobr><span class="ft5">then, N e = N e</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:491"><nobr><span class="ft5">4. (N e)[p</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:551"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:556"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:571"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:576"><nobr><span class="ft5">] = N (e[p</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:635"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:640"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:655"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:659"><nobr><span class="ft5">])</span></nobr></DIV>
<DIV style="position:absolute;top:371;left:491"><nobr><span class="ft5">5. (N e)[p</span></nobr></DIV>
<DIV style="position:absolute;top:376;left:558"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:371;left:563"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:376;left:577"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:371;left:582"><nobr><span class="ft5">] = N (e[p</span></nobr></DIV>
<DIV style="position:absolute;top:376;left:648"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:371;left:653"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:376;left:667"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:371;left:672"><nobr><span class="ft5">])</span></nobr></DIV>
<DIV style="position:absolute;top:408;left:490"><nobr><span class="ft5">Proof.</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:491"><nobr><span class="ft5">1. By structural induction on e.</span></nobr></DIV>
<DIV style="position:absolute;top:455;left:491"><nobr><span class="ft5">2. Trivial.</span></nobr></DIV>
<DIV style="position:absolute;top:480;left:491"><nobr><span class="ft5">3. Trivial.</span></nobr></DIV>
<DIV style="position:absolute;top:505;left:491"><nobr><span class="ft5">4. By definition of N and of substitutions.</span></nobr></DIV>
<DIV style="position:absolute;top:530;left:491"><nobr><span class="ft5">5. By definition of N and of substitutions.</span></nobr></DIV>
<DIV style="position:absolute;top:586;left:489"><nobr><span class="ft5">To see that both semantics reduce an expression to equiv-</span></nobr></DIV>
<DIV style="position:absolute;top:602;left:475"><nobr><span class="ft10">alent normal forms, first we prove that the normalization<br>does not change the meaning of an expression within Ses-<br>toft's semantics. Then, we prove that both semantics reduce<br>any FUN expression to equivalent normal forms, provided<br>that such normal forms exist.</span></nobr></DIV>
<DIV style="position:absolute;top:688;left:475"><nobr><span class="ft4"><b>2.1</b></span></nobr></DIV>
<DIV style="position:absolute;top:688;left:516"><nobr><span class="ft4"><b>Soundness and completeness</b></span></nobr></DIV>
<DIV style="position:absolute;top:707;left:489"><nobr><span class="ft5">The following two propositions prove that the normaliza-</span></nobr></DIV>
<DIV style="position:absolute;top:722;left:475"><nobr><span class="ft10">tion does not change the meaning of an expression. We use<br>the following notation:  denotes a one-to-one renaming of<br>pointers, and  </span></nobr></DIV>
<DIV style="position:absolute;top:757;left:582"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:752;left:594"><nobr><span class="ft5"> means that     . This is needed</span></nobr></DIV>
<DIV style="position:absolute;top:767;left:475"><nobr><span class="ft10">to express the equivalence between the heaps of both seman-<br>tics up to some renaming . As S3 generates more closures<br>than Sestoft's, it is not possible to guarantee that the fresh<br>pointers are exactly the same in the two heaps.</span></nobr></DIV>
<DIV style="position:absolute;top:838;left:490"><nobr><span class="ft5">Proposition 2. (Sestoft  Sestoft</span></nobr></DIV>
<DIV style="position:absolute;top:837;left:705"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:838;left:712"><nobr><span class="ft5">) For all e  Launch</span></nobr></DIV>
<DIV style="position:absolute;top:854;left:475"><nobr><span class="ft5">we have:</span></nobr></DIV>
<DIV style="position:absolute;top:891;left:518"><nobr><span class="ft5">{ } : e   : w </span></nobr></DIV>
<DIV style="position:absolute;top:864;left:624"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:876;left:624"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:900;left:624"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:875;left:643"><nobr><span class="ft5">{ } : N e  </span></nobr></DIV>
<DIV style="position:absolute;top:873;left:720"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:875;left:730"><nobr><span class="ft5">: w</span></nobr></DIV>
<DIV style="position:absolute;top:873;left:748"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:899;left:643"><nobr><span class="ft5">.</span></nobr></DIV>
<DIV style="position:absolute;top:891;left:683"><nobr><span class="ft5">w</span></nobr></DIV>
<DIV style="position:absolute;top:889;left:693"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:891;left:703"><nobr><span class="ft5">= N ( w)</span></nobr></DIV>
<DIV style="position:absolute;top:906;left:683"><nobr><span class="ft5">N  </span></nobr></DIV>
<DIV style="position:absolute;top:911;left:730"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:906;left:742"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:904;left:753"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:929;left:490"><nobr><span class="ft5">Proof. By induction on the number of reductions of</span></nobr></DIV>
<DIV style="position:absolute;top:944;left:475"><nobr><span class="ft5">Launchbury expressions.</span></nobr></DIV>
<DIV style="position:absolute;top:971;left:490"><nobr><span class="ft5">Proposition 3. (Sestoft</span></nobr></DIV>
<DIV style="position:absolute;top:969;left:642"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:971;left:655"><nobr><span class="ft5"> Sestoft) For all e  FUN</span></nobr></DIV>
<DIV style="position:absolute;top:986;left:475"><nobr><span class="ft5">we have:</span></nobr></DIV>
<DIV style="position:absolute;top:1007;left:482"><nobr><span class="ft5">{ } : e   : w </span></nobr></DIV>
<DIV style="position:absolute;top:1039;left:502"><nobr><span class="ft5">e  Launch.</span></nobr></DIV>
<DIV style="position:absolute;top:1012;left:587"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1036;left:587"><nobr><span class="ft5">N e = e </span></nobr></DIV>
<DIV style="position:absolute;top:1011;left:671"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1023;left:671"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1047;left:671"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1022;left:690"><nobr><span class="ft5">{ } : e   : w</span></nobr></DIV>
<DIV style="position:absolute;top:1046;left:690"><nobr><span class="ft5">.</span></nobr></DIV>
<DIV style="position:absolute;top:1038;left:730"><nobr><span class="ft10">N ( w ) = w<br>N  </span></nobr></DIV>
<DIV style="position:absolute;top:1059;left:781"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:1054;left:793"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1012;left:835"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1036;left:835"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">104</span></nobr></DIV>
</DIV>
<!-- Page 4 -->
<a name="4"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="918" height="1188" src="95004.png" alt="background image">
<DIV style="position:absolute;top:90;left:354"><nobr><span class="ft5">[p  x</span></nobr></DIV>
<DIV style="position:absolute;top:96;left:411"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:423"><nobr><span class="ft5">.e] : p   : p</span></nobr></DIV>
<DIV style="position:absolute;top:90;left:672"><nobr><span class="ft5">Lam</span></nobr></DIV>
<DIV style="position:absolute;top:96;left:699"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:118;left:361"><nobr><span class="ft5">[p  C p</span></nobr></DIV>
<DIV style="position:absolute;top:123;left:422"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:118;left:427"><nobr><span class="ft5">] : p   : p</span></nobr></DIV>
<DIV style="position:absolute;top:118;left:672"><nobr><span class="ft5">Cons</span></nobr></DIV>
<DIV style="position:absolute;top:123;left:703"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:146;left:278"><nobr><span class="ft5"> : e  [p  x</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:379"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:146;left:392"><nobr><span class="ft5">.y</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:410"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:146;left:426"><nobr><span class="ft5">.e ] : p</span></nobr></DIV>
<DIV style="position:absolute;top:169;left:252"><nobr><span class="ft5"> : e p</span></nobr></DIV>
<DIV style="position:absolute;top:174;left:290"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:169;left:306"><nobr><span class="ft5">   [q  y</span></nobr></DIV>
<DIV style="position:absolute;top:174;left:391"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:169;left:406"><nobr><span class="ft5">.e [p</span></nobr></DIV>
<DIV style="position:absolute;top:174;left:431"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:169;left:436"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:174;left:451"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:164;left:455"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:169;left:463"><nobr><span class="ft5">]] : q m, n &gt; 0, q fresh</span></nobr></DIV>
<DIV style="position:absolute;top:169;left:672"><nobr><span class="ft5">App</span></nobr></DIV>
<DIV style="position:absolute;top:174;left:697"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:193"><nobr><span class="ft5"> : e  [p  x</span></nobr></DIV>
<DIV style="position:absolute;top:213;left:294"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:309"><nobr><span class="ft5">.e ] : p  : e [p</span></nobr></DIV>
<DIV style="position:absolute;top:213;left:404"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:409"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:213;left:423"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:203;left:428"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:439"><nobr><span class="ft5">] p</span></nobr></DIV>
<DIV style="position:absolute;top:213;left:454"><nobr><span class="ft1">m+1</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:481"><nobr><span class="ft5">. . . p</span></nobr></DIV>
<DIV style="position:absolute;top:213;left:506"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:518"><nobr><span class="ft5"> [q  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:227;left:351"><nobr><span class="ft5"> : e p</span></nobr></DIV>
<DIV style="position:absolute;top:233;left:389"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:227;left:405"><nobr><span class="ft5">  : q</span></nobr></DIV>
<DIV style="position:absolute;top:218;left:611"><nobr><span class="ft5">n  m</span></nobr></DIV>
<DIV style="position:absolute;top:227;left:672"><nobr><span class="ft5">App</span></nobr></DIV>
<DIV style="position:absolute;top:234;left:697"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:263;left:367"><nobr><span class="ft5"> : e  [q  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:283;left:330"><nobr><span class="ft5">  [p  e] : p    [p  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:283;left:672"><nobr><span class="ft5">Var</span></nobr></DIV>
<DIV style="position:absolute;top:289;left:694"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:305"><nobr><span class="ft5">  [p</span></nobr></DIV>
<DIV style="position:absolute;top:330;left:340"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:348"><nobr><span class="ft5"> ^</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:366"><nobr><span class="ft5">lf</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:377"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:381"><nobr><span class="ft5">] : ^</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:397"><nobr><span class="ft5">e  [p  w] : p</span></nobr></DIV>
<DIV style="position:absolute;top:347;left:308"><nobr><span class="ft5"> : letrec x</span></nobr></DIV>
<DIV style="position:absolute;top:352;left:379"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:347;left:388"><nobr><span class="ft5">= lf</span></nobr></DIV>
<DIV style="position:absolute;top:354;left:413"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:347;left:422"><nobr><span class="ft5">in e   : p p</span></nobr></DIV>
<DIV style="position:absolute;top:340;left:509"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:335;left:518"><nobr><span class="ft5">fresh</span></nobr></DIV>
<DIV style="position:absolute;top:347;left:672"><nobr><span class="ft5">Letrec</span></nobr></DIV>
<DIV style="position:absolute;top:352;left:708"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:256"><nobr><span class="ft5"> : e  [p  C</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:354"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:365"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:372"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:378"><nobr><span class="ft5">] : p</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:423"><nobr><span class="ft5"> : e</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:453"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:460"><nobr><span class="ft5">[p</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:470"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:476"><nobr><span class="ft5">/y</span></nobr></DIV>
<DIV style="position:absolute;top:391;left:490"><nobr><span class="ft1">kj</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:502"><nobr><span class="ft5">]  [q  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:408;left:328"><nobr><span class="ft5"> : case e of C</span></nobr></DIV>
<DIV style="position:absolute;top:413;left:421"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:408;left:431"><nobr><span class="ft5">y</span></nobr></DIV>
<DIV style="position:absolute;top:413;left:437"><nobr><span class="ft1">ij</span></nobr></DIV>
<DIV style="position:absolute;top:408;left:451"><nobr><span class="ft5"> e</span></nobr></DIV>
<DIV style="position:absolute;top:413;left:475"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:408;left:484"><nobr><span class="ft5">  : q</span></nobr></DIV>
<DIV style="position:absolute;top:408;left:672"><nobr><span class="ft5">Case</span></nobr></DIV>
<DIV style="position:absolute;top:413;left:701"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:460;left:377"><nobr><span class="ft5">Figure 4: Semantics S3</span></nobr></DIV>
<DIV style="position:absolute;top:505;left:96"><nobr><span class="ft5">Proof. By induction on the number of reductions of</span></nobr></DIV>
<DIV style="position:absolute;top:520;left:81"><nobr><span class="ft5">Launchbury expressions.</span></nobr></DIV>
<DIV style="position:absolute;top:547;left:94"><nobr><span class="ft5">Now we prove the equivalence between the two seman-</span></nobr></DIV>
<DIV style="position:absolute;top:563;left:81"><nobr><span class="ft10">tics. We consider only FUN expressions because it has been<br>proved that the normalization does not change the meaning<br>of an expression.</span></nobr></DIV>
<DIV style="position:absolute;top:620;left:96"><nobr><span class="ft5">Proposition 4. (Sestoft  S3, completeness of S3) For</span></nobr></DIV>
<DIV style="position:absolute;top:635;left:81"><nobr><span class="ft5">all e  FUN we have:</span></nobr></DIV>
<DIV style="position:absolute;top:674;left:126"><nobr><span class="ft5">{ } : e   : w </span></nobr></DIV>
<DIV style="position:absolute;top:646;left:232"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:659;left:232"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:683;left:232"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:658;left:251"><nobr><span class="ft5">{ } : e   [p  w ] : p</span></nobr></DIV>
<DIV style="position:absolute;top:682;left:251"><nobr><span class="ft5">.</span></nobr></DIV>
<DIV style="position:absolute;top:674;left:291"><nobr><span class="ft10"> w = w<br> </span></nobr></DIV>
<DIV style="position:absolute;top:694;left:317"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:689;left:329"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:728;left:96"><nobr><span class="ft5">Proof. By induction on the number of reductions of</span></nobr></DIV>
<DIV style="position:absolute;top:743;left:81"><nobr><span class="ft5">FUN expressions.</span></nobr></DIV>
<DIV style="position:absolute;top:770;left:96"><nobr><span class="ft5">Proposition 5. (S3  Sestoft, soundness of S3) For all</span></nobr></DIV>
<DIV style="position:absolute;top:786;left:81"><nobr><span class="ft5">e  FUN we have:</span></nobr></DIV>
<DIV style="position:absolute;top:824;left:120"><nobr><span class="ft5">{ } : e  [p  w] : p </span></nobr></DIV>
<DIV style="position:absolute;top:796;left:267"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:809;left:267"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:833;left:267"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:808;left:286"><nobr><span class="ft5">{ } : e   : w</span></nobr></DIV>
<DIV style="position:absolute;top:832;left:286"><nobr><span class="ft5">.</span></nobr></DIV>
<DIV style="position:absolute;top:824;left:326"><nobr><span class="ft10"> w = w<br> </span></nobr></DIV>
<DIV style="position:absolute;top:844;left:356"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:839;left:368"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:878;left:96"><nobr><span class="ft5">Proof. By induction on the number of reductions of</span></nobr></DIV>
<DIV style="position:absolute;top:893;left:81"><nobr><span class="ft5">FUN expressions.</span></nobr></DIV>
<DIV style="position:absolute;top:921;left:94"><nobr><span class="ft5">Once adapted the source language to the STG language,</span></nobr></DIV>
<DIV style="position:absolute;top:936;left:81"><nobr><span class="ft10">we are ready to derive an STG-like machine from semantics<br>S3.</span></nobr></DIV>
<DIV style="position:absolute;top:986;left:81"><nobr><span class="ft4"><b>3.</b></span></nobr></DIV>
<DIV style="position:absolute;top:986;left:112"><nobr><span class="ft4"><b>A VERY SIMPLE STG MACHINE</b></span></nobr></DIV>
<DIV style="position:absolute;top:1004;left:94"><nobr><span class="ft5">Following a similar approach to Sestoft MARK-1 machine</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:81"><nobr><span class="ft10">[10], we first introduce a very simple STG machine, which<br>we will call STG-1, in which explicit variable substitutions<br>are done. A configuration in this machine is a triple (, e, S)<br>where  represents the heap, e is the control expression and</span></nobr></DIV>
<DIV style="position:absolute;top:505;left:475"><nobr><span class="ft10">S is the stack. The heap binds pointers to lambda forms<br>which, in turn, may reference other pointers. The stack<br>stores three kinds of objects: arguments p</span></nobr></DIV>
<DIV style="position:absolute;top:540;left:724"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:733"><nobr><span class="ft5">of pending appli-</span></nobr></DIV>
<DIV style="position:absolute;top:550;left:475"><nobr><span class="ft10">cations, case alternatives alts of pending pattern matchings,<br>and marks #p of pending updates.</span></nobr></DIV>
<DIV style="position:absolute;top:580;left:489"><nobr><span class="ft5">In Figure 5, the transitions of the machine are shown.</span></nobr></DIV>
<DIV style="position:absolute;top:595;left:475"><nobr><span class="ft10">They look very close to the lazy semantics S3 presented in<br>Section 2. For instance, the single rule for letrec in Fig-<br>ure 5 is a literal transcription of the Letrec</span></nobr></DIV>
<DIV style="position:absolute;top:630;left:733"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:625;left:752"><nobr><span class="ft5">rule of Figure</span></nobr></DIV>
<DIV style="position:absolute;top:640;left:475"><nobr><span class="ft10">4. The semantic rules for case and applications are split<br>each one into two rules in the machine. The semantic rule<br>for variable is also split into two in order to take care of<br>updating the closure. So, in principle, an execution of the<br>STG-1 machine could be regarded as the linearization of the<br>semantic derivation tree by introducing an auxiliary stack.</span></nobr></DIV>
<DIV style="position:absolute;top:731;left:489"><nobr><span class="ft5">But sometimes appearances are misleading. The theorem</span></nobr></DIV>
<DIV style="position:absolute;top:746;left:475"><nobr><span class="ft10">below shows that in fact STG-1 builds less closures in the<br>heap than the semantics and it may arrive to different (but<br>semantically equivalent) normal forms. In order to prove<br>the soundness and completeness of STG-1, we first enrich<br>the semantics with a stack parameter S in the rules. The<br>new rules for </span></nobr></DIV>
<DIV style="position:absolute;top:826;left:566"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:821;left:578"><nobr><span class="ft5">(only those which modify S) are shown in</span></nobr></DIV>
<DIV style="position:absolute;top:836;left:475"><nobr><span class="ft10">Figure 6. It is trivial to show that the rules are equivalent to<br>the ones in Figure 4 as the stack is just an observation of the<br>derivations. It may not influence them. The following theo-<br>rem establishes the correspondence between the (enriched)<br>semantics and the machine.</span></nobr></DIV>
<DIV style="position:absolute;top:928;left:490"><nobr><span class="ft5">Proposition 6. Given , e and S, then  : e </span></nobr></DIV>
<DIV style="position:absolute;top:933;left:781"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:928;left:793"><nobr><span class="ft5">[p </span></nobr></DIV>
<DIV style="position:absolute;top:943;left:475"><nobr><span class="ft5">w] : p iff (, e, S) </span></nobr></DIV>
<DIV style="position:absolute;top:941;left:595"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:943;left:606"><nobr><span class="ft5">( , p , S ), where</span></nobr></DIV>
<DIV style="position:absolute;top:970;left:491"><nobr><span class="ft5">1.   </span></nobr></DIV>
<DIV style="position:absolute;top:999;left:491"><nobr><span class="ft5">2. if [p  C p</span></nobr></DIV>
<DIV style="position:absolute;top:1004;left:598"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:999;left:610"><nobr><span class="ft5">] then S = S , p = p and  [p </span></nobr></DIV>
<DIV style="position:absolute;top:1014;left:509"><nobr><span class="ft5">C p</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:532"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:1014;left:544"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:1043;left:491"><nobr><span class="ft5">3. if [p  x</span></nobr></DIV>
<DIV style="position:absolute;top:1049;left:582"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:1043;left:594"><nobr><span class="ft5">.e ] then there exists m  0 s.t.  [p </span></nobr></DIV>
<DIV style="position:absolute;top:1061;left:509"><nobr><span class="ft5">y</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:524"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:1061;left:539"><nobr><span class="ft5">.x</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:559"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:1061;left:571"><nobr><span class="ft5">.e ] and S = q</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:662"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:1061;left:681"><nobr><span class="ft5">: S and e = e [q</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:783"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1061;left:787"><nobr><span class="ft5">/y</span></nobr></DIV>
<DIV style="position:absolute;top:1066;left:801"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:1056;left:806"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:1061;left:816"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">105</span></nobr></DIV>
</DIV>
<!-- Page 5 -->
<a name="5"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
	.ft14{font-size:5px;font-family:Times;color:#000000;}
-->
</STYLE>
<IMG width="918" height="1188" src="95005.png" alt="background image">
<DIV style="position:absolute;top:80;left:238"><nobr><span class="ft5">Heap</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:385"><nobr><span class="ft5">Control</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:543"><nobr><span class="ft5">Stack</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:660"><nobr><span class="ft5">rule</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:113;left:385"><nobr><span class="ft5">letrec {x</span></nobr></DIV>
<DIV style="position:absolute;top:118;left:443"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:452"><nobr><span class="ft5">= lf</span></nobr></DIV>
<DIV style="position:absolute;top:120;left:477"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:482"><nobr><span class="ft5">} in e</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:660"><nobr><span class="ft5">letrec (</span></nobr></DIV>
<DIV style="position:absolute;top:111;left:703"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:709"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:238"><nobr><span class="ft5">  [p</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:273"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:282"><nobr><span class="ft5"> lf</span></nobr></DIV>
<DIV style="position:absolute;top:140;left:310"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:315"><nobr><span class="ft5">[p</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:326"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:331"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:346"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:352"><nobr><span class="ft5">]]</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:385"><nobr><span class="ft5">e[p</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:402"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:407"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:422"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:427"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:152;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:152;left:385"><nobr><span class="ft5">case e of alts</span></nobr></DIV>
<DIV style="position:absolute;top:152;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:152;left:660"><nobr><span class="ft5">case1</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:167;left:385"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:543"><nobr><span class="ft5">alts : S</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:238"><nobr><span class="ft5">[p  C</span></nobr></DIV>
<DIV style="position:absolute;top:194;left:289"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:301"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:194;left:308"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:312"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:385"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:543"><nobr><span class="ft5">C</span></nobr></DIV>
<DIV style="position:absolute;top:194;left:553"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:563"><nobr><span class="ft5">y</span></nobr></DIV>
<DIV style="position:absolute;top:194;left:570"><nobr><span class="ft1">ji</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:584"><nobr><span class="ft5"> e</span></nobr></DIV>
<DIV style="position:absolute;top:194;left:608"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:618"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:188;left:660"><nobr><span class="ft5">case2</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:206;left:385"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:211;left:392"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:398"><nobr><span class="ft5">[p</span></nobr></DIV>
<DIV style="position:absolute;top:211;left:409"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:414"><nobr><span class="ft5">/y</span></nobr></DIV>
<DIV style="position:absolute;top:211;left:428"><nobr><span class="ft1">ki</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:438"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:225;left:385"><nobr><span class="ft5">e p</span></nobr></DIV>
<DIV style="position:absolute;top:230;left:403"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:225;left:660"><nobr><span class="ft5">app1</span></nobr></DIV>
<DIV style="position:absolute;top:240;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:240;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:240;left:385"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:240;left:543"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:245;left:550"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:240;left:566"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:259;left:238"><nobr><span class="ft5">[p  x</span></nobr></DIV>
<DIV style="position:absolute;top:265;left:295"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:259;left:308"><nobr><span class="ft5">.e]</span></nobr></DIV>
<DIV style="position:absolute;top:259;left:385"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:259;left:543"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:265;left:550"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:259;left:566"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:259;left:660"><nobr><span class="ft5">app2</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:277;left:385"><nobr><span class="ft5">e[p</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:402"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:407"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:422"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:272;left:427"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:434"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:296;left:238"><nobr><span class="ft5">  [p  e ]</span></nobr></DIV>
<DIV style="position:absolute;top:296;left:385"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:296;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:296;left:660"><nobr><span class="ft5">var1</span></nobr></DIV>
<DIV style="position:absolute;top:312;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:312;left:238"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:312;left:385"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:312;left:543"><nobr><span class="ft5">#p : S</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:238"><nobr><span class="ft5">[p  x</span></nobr></DIV>
<DIV style="position:absolute;top:338;left:295"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:307"><nobr><span class="ft5">.y</span></nobr></DIV>
<DIV style="position:absolute;top:338;left:326"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:341"><nobr><span class="ft5">.e]</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:385"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:543"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:338;left:550"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:565"><nobr><span class="ft5">: #q : S</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:660"><nobr><span class="ft5">var2</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:238"><nobr><span class="ft5">  [q  p p</span></nobr></DIV>
<DIV style="position:absolute;top:354;left:313"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:325"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:385"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:543"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:354;left:550"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:565"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:238"><nobr><span class="ft5">[p  C</span></nobr></DIV>
<DIV style="position:absolute;top:374;left:289"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:301"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:373;left:308"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:312"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:385"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:543"><nobr><span class="ft5">#q : S</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:660"><nobr><span class="ft5">var3</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:200"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:238"><nobr><span class="ft5">  [q  C</span></nobr></DIV>
<DIV style="position:absolute;top:389;left:304"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:316"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:389;left:323"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:327"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:385"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:543"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:203"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:418;left:208"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:214"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:238"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:425;left:245"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:255"><nobr><span class="ft5">are distinct and fresh w.r.t. , letrec {x</span></nobr></DIV>
<DIV style="position:absolute;top:425;left:500"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:514"><nobr><span class="ft5">= lf</span></nobr></DIV>
<DIV style="position:absolute;top:427;left:543"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:548"><nobr><span class="ft5">} in e, and S</span></nobr></DIV>
<DIV style="position:absolute;top:464;left:351"><nobr><span class="ft5">Figure 5: The STG-1 Machine</span></nobr></DIV>
<DIV style="position:absolute;top:508;left:96"><nobr><span class="ft5">Proof. By induction on the number of reductions of</span></nobr></DIV>
<DIV style="position:absolute;top:523;left:81"><nobr><span class="ft5">FUN expressions.</span></nobr></DIV>
<DIV style="position:absolute;top:555;left:94"><nobr><span class="ft5">The proposition shows that the semantic rule App</span></nobr></DIV>
<DIV style="position:absolute;top:560;left:409"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:555;left:428"><nobr><span class="ft5">of</span></nobr></DIV>
<DIV style="position:absolute;top:570;left:81"><nobr><span class="ft10">Figure 4 is not literally transcribed in the machine. The<br>machine does not create intermediate lambdas in the heap<br>unless an update is needed. Rule app2 in Figure 5 applies a<br>lambda always to all its arguments provided that they are in<br>the stack. For this reason, a lambda with more parameters<br>than that of the semantics may be arrived at as normal<br>form of a functional expression. Also for this reason, an<br>update mark may be interspersed with arguments in the<br>stack when a lambda is reached (see rule var2 in Figure 5).<br>A final implication is that the machine may stop with m<br>pending arguments in the stack and a variable in the control<br>expression pointing to a lambda with n &gt; m parameters.<br>The semantics always ends a derivation with a variable as<br>normal form and an empty stack.</span></nobr></DIV>
<DIV style="position:absolute;top:781;left:94"><nobr><span class="ft5">Again, following Sestoft and his MARK-2 machine, once</span></nobr></DIV>
<DIV style="position:absolute;top:796;left:81"><nobr><span class="ft10">we have proved the soundness and completeness of STG-1,<br>we introduce STG-2 having environments instead of explicit<br>variable substitutions. Also, we add trimmers to this ma-<br>chine so that environments kept in closures and in case al-<br>ternatives only reference the free variables of the expression<br>instead of all variables in scope. A configuration of STG-2<br>is a quadruple (, e, E, S) where E is the environment of e,<br>the alternatives are pairs (alts, E), and a closure is a pair<br>(lf , E). Now expressions and lambda forms keep their origi-<br>nal variables and the associated environment maps them to<br>pointers in the heap. The notation E |</span></nobr></DIV>
<DIV style="position:absolute;top:944;left:310"><nobr><span class="ft1">t</span></nobr></DIV>
<DIV style="position:absolute;top:946;left:319"><nobr><span class="ft5">means the trimming</span></nobr></DIV>
<DIV style="position:absolute;top:961;left:81"><nobr><span class="ft10">of environment E to the trimmer t. A trimmer is just a col-<br>lection of variable names. The resulting machine is shown<br>in Figure 7.</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:96"><nobr><span class="ft5">Proposition 7.</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:237"><nobr><span class="ft5">Given a closed expression e</span></nobr></DIV>
<DIV style="position:absolute;top:1024;left:402"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:408"><nobr><span class="ft5">.</span></nobr></DIV>
<DIV style="position:absolute;top:1037;left:81"><nobr><span class="ft5">({ }, e</span></nobr></DIV>
<DIV style="position:absolute;top:1042;left:116"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:1037;left:122"><nobr><span class="ft5">, [ ])</span></nobr></DIV>
<DIV style="position:absolute;top:1035;left:148"><nobr><span class="ft14">STG-1</span></nobr></DIV>
<DIV style="position:absolute;top:1037;left:150"><nobr><span class="ft5">- (, q, p</span></nobr></DIV>
<DIV style="position:absolute;top:1042;left:220"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:1037;left:233"><nobr><span class="ft5">) where either:</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:101"><nobr><span class="ft5">· [q  C q</span></nobr></DIV>
<DIV style="position:absolute;top:1070;left:180"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:195"><nobr><span class="ft5">]  n = 0</span></nobr></DIV>
<DIV style="position:absolute;top:508;left:495"><nobr><span class="ft5">· or [q  x</span></nobr></DIV>
<DIV style="position:absolute;top:514;left:586"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:508;left:601"><nobr><span class="ft5">.e]  m &gt; n  0</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:475"><nobr><span class="ft5">if and only if ({ }, e</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:595"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:601"><nobr><span class="ft5">, { }, [ ])</span></nobr></DIV>
<DIV style="position:absolute;top:536;left:651"><nobr><span class="ft14">STG-2</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:653"><nobr><span class="ft5">- (, x, E[x  q], p</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:784"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:796"><nobr><span class="ft5">)) and</span></nobr></DIV>
<DIV style="position:absolute;top:554;left:475"><nobr><span class="ft5">either:</span></nobr></DIV>
<DIV style="position:absolute;top:581;left:495"><nobr><span class="ft5">· [q  (C x</span></nobr></DIV>
<DIV style="position:absolute;top:586;left:578"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:581;left:594"><nobr><span class="ft5">, {x</span></nobr></DIV>
<DIV style="position:absolute;top:586;left:615"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:581;left:623"><nobr><span class="ft5"> q</span></nobr></DIV>
<DIV style="position:absolute;top:586;left:647"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:581;left:662"><nobr><span class="ft5">})]  n = 0</span></nobr></DIV>
<DIV style="position:absolute;top:608;left:495"><nobr><span class="ft5">· or [q  (x</span></nobr></DIV>
<DIV style="position:absolute;top:614;left:589"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:608;left:604"><nobr><span class="ft5">.e , E )]  m &gt; n  0  e = E e .</span></nobr></DIV>
<DIV style="position:absolute;top:632;left:490"><nobr><span class="ft5">Proof. By induction on the number of reductions.</span></nobr></DIV>
<DIV style="position:absolute;top:669;left:475"><nobr><span class="ft4"><b>4.</b></span></nobr></DIV>
<DIV style="position:absolute;top:669;left:507"><nobr><span class="ft4"><b>AN IMPERATIVE STG MACHINE</b></span></nobr></DIV>
<DIV style="position:absolute;top:688;left:489"><nobr><span class="ft5">In this Section we `invent' an imperative STG machine,</span></nobr></DIV>
<DIV style="position:absolute;top:703;left:475"><nobr><span class="ft10">called ISTG, by defining a set of machine instructions and<br>an operational semantics for them in terms of the state tran-<br>sition that each instruction produces. In fact, this machine<br>tries to provide an intermediate level of reasoning between<br>the STG-2 machine and the final C implementation. In<br>the actual GHC implementation, `below' the operational de-<br>scription of [6] we find only a translation to C. By looking<br>at the compiler and at the runtime system listings, one can<br>grasp some details, but many others are lost. We think that<br>the gap to be bridged is too high. Moreover, it is not pos-<br>sible to reason about the correctness of the implementation<br>when so many details are introduced at once. The ISTG ar-<br>chitecture has been inspired by the actual implementation of<br>the STG machine done by GHC, and the ISTG instructions<br>have been derived from the STG-2 machine by analyzing the<br>elementary steps involved in every machine transition.</span></nobr></DIV>
<DIV style="position:absolute;top:944;left:489"><nobr><span class="ft5">An ISTG machine configuration consists of a 5-tuple (is, S,</span></nobr></DIV>
<DIV style="position:absolute;top:959;left:475"><nobr><span class="ft10">node, , cs), where is is a machine instruction sequence ended<br>with the instruction ENTER or RETURNCON, S is the<br>stack, node is a heap pointer pointing to the closure under<br>execution (the one to which is belongs to),  is the heap and<br>cs is a code store where the instruction sequences resulting<br>from compiling the program expressions are kept.</span></nobr></DIV>
<DIV style="position:absolute;top:1049;left:489"><nobr><span class="ft5">We will use the following notation: a for pointers to clo-</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:475"><nobr><span class="ft5">sures in , as and ws for lists of such pointers, and p for</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">106</span></nobr></DIV>
</DIV>
<!-- Page 6 -->
<a name="6"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="918" height="1188" src="95006.png" alt="background image">
<DIV style="position:absolute;top:105;left:265"><nobr><span class="ft5"> : e </span></nobr></DIV>
<DIV style="position:absolute;top:111;left:303"><nobr><span class="ft1">p</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:308"><nobr><span class="ft14">in</span></nobr></DIV>
<DIV style="position:absolute;top:111;left:320"><nobr><span class="ft1">:S</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:335"><nobr><span class="ft5">[p  x</span></nobr></DIV>
<DIV style="position:absolute;top:111;left:395"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:407"><nobr><span class="ft5">.y</span></nobr></DIV>
<DIV style="position:absolute;top:111;left:426"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:441"><nobr><span class="ft5">.e ] : p</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:249"><nobr><span class="ft5"> : e p</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:287"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:303"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:134;left:310"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:322"><nobr><span class="ft5">  [q  y</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:396"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:411"><nobr><span class="ft5">.e [p</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:436"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:441"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:456"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:123;left:461"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:468"><nobr><span class="ft5">]] : q m, n &gt; 0, q fresh</span></nobr></DIV>
<DIV style="position:absolute;top:129;left:687"><nobr><span class="ft5">App</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:712"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:180"><nobr><span class="ft5"> : e </span></nobr></DIV>
<DIV style="position:absolute;top:173;left:218"><nobr><span class="ft1">p</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:223"><nobr><span class="ft14">in</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:235"><nobr><span class="ft1">:S</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:250"><nobr><span class="ft5">[p  x</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:310"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:325"><nobr><span class="ft5">.e ] : p  : e [p</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:420"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:425"><nobr><span class="ft5">/x</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:440"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:444"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:455"><nobr><span class="ft5">] p</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:470"><nobr><span class="ft1">m+1</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:497"><nobr><span class="ft5">. . . p</span></nobr></DIV>
<DIV style="position:absolute;top:173;left:522"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:534"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:173;left:541"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:553"><nobr><span class="ft5">[q  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:353"><nobr><span class="ft5"> : e p</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:391"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:407"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:192;left:414"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:426"><nobr><span class="ft5"> : q</span></nobr></DIV>
<DIV style="position:absolute;top:178;left:635"><nobr><span class="ft5">n  m</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:697"><nobr><span class="ft5">App</span></nobr></DIV>
<DIV style="position:absolute;top:193;left:721"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:223;left:352"><nobr><span class="ft5"> : e </span></nobr></DIV>
<DIV style="position:absolute;top:228;left:389"><nobr><span class="ft1">#p:S</span></nobr></DIV>
<DIV style="position:absolute;top:223;left:419"><nobr><span class="ft5">[q  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:243;left:324"><nobr><span class="ft5">  [p  e] : p </span></nobr></DIV>
<DIV style="position:absolute;top:248;left:420"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:243;left:431"><nobr><span class="ft5">  [p  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:243;left:687"><nobr><span class="ft5">Var</span></nobr></DIV>
<DIV style="position:absolute;top:248;left:710"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:239"><nobr><span class="ft5"> : e </span></nobr></DIV>
<DIV style="position:absolute;top:287;left:278"><nobr><span class="ft1">alts:S</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:312"><nobr><span class="ft5">[p  C</span></nobr></DIV>
<DIV style="position:absolute;top:287;left:366"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:377"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:287;left:384"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:390"><nobr><span class="ft5">] : p</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:436"><nobr><span class="ft5"> : e</span></nobr></DIV>
<DIV style="position:absolute;top:287;left:465"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:472"><nobr><span class="ft5">[p</span></nobr></DIV>
<DIV style="position:absolute;top:287;left:483"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:489"><nobr><span class="ft5">/y</span></nobr></DIV>
<DIV style="position:absolute;top:287;left:502"><nobr><span class="ft1">kj</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:514"><nobr><span class="ft5">] </span></nobr></DIV>
<DIV style="position:absolute;top:287;left:529"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:282;left:541"><nobr><span class="ft5">[q  w] : q</span></nobr></DIV>
<DIV style="position:absolute;top:301;left:348"><nobr><span class="ft5"> : case e of alts </span></nobr></DIV>
<DIV style="position:absolute;top:306;left:465"><nobr><span class="ft1">S</span></nobr></DIV>
<DIV style="position:absolute;top:301;left:477"><nobr><span class="ft5"> : q</span></nobr></DIV>
<DIV style="position:absolute;top:301;left:687"><nobr><span class="ft5">Case</span></nobr></DIV>
<DIV style="position:absolute;top:306;left:716"><nobr><span class="ft1">S3</span></nobr></DIV>
<DIV style="position:absolute;top:353;left:341"><nobr><span class="ft5">Figure 6: The enriched semantics</span></nobr></DIV>
<DIV style="position:absolute;top:398;left:81"><nobr><span class="ft10">pointers to code fragments in cs. By cs[p  is] we de-<br>note that the code store cs maps pointer p to the instruc-<br>tion sequence is and, by cs[p  is</span></nobr></DIV>
<DIV style="position:absolute;top:433;left:292"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:424;left:297"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:428;left:305"><nobr><span class="ft5">], that cs maps p to a</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:81"><nobr><span class="ft5">vectored set of instruction sequences is</span></nobr></DIV>
<DIV style="position:absolute;top:448;left:322"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:328"><nobr><span class="ft5">, . . . , is</span></nobr></DIV>
<DIV style="position:absolute;top:448;left:369"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:377"><nobr><span class="ft5">, each one</span></nobr></DIV>
<DIV style="position:absolute;top:458;left:81"><nobr><span class="ft10">corresponding to an alternative of a case expression with<br>n constructors C</span></nobr></DIV>
<DIV style="position:absolute;top:478;left:184"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:473;left:190"><nobr><span class="ft5">, . . . , C</span></nobr></DIV>
<DIV style="position:absolute;top:478;left:231"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:473;left:239"><nobr><span class="ft5">. Also, S ! i will denote the i-th</span></nobr></DIV>
<DIV style="position:absolute;top:488;left:81"><nobr><span class="ft10">element of the stack S counting from the top and starting<br>at 0. Likewise, node</span></nobr></DIV>
<DIV style="position:absolute;top:509;left:202"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:503;left:213"><nobr><span class="ft5">! i will denote the i-th free variable of</span></nobr></DIV>
<DIV style="position:absolute;top:518;left:81"><nobr><span class="ft5">the closure pointed to by node in , this time starting at 1.</span></nobr></DIV>
<DIV style="position:absolute;top:533;left:94"><nobr><span class="ft5">Stack S may store pointers a to closures in , pointers p</span></nobr></DIV>
<DIV style="position:absolute;top:548;left:81"><nobr><span class="ft10">to code sequences and code alternatives in cs, and update<br>marks #a indicating that closure pointed to by a must be<br>updated. A closure is a pair (p, ws) where p is a pointer<br>to an instruction sequence is in cs, and ws is the closure<br>environment, having a heap pointer for every free variable<br>in the expression whose translation is is.</span></nobr></DIV>
<DIV style="position:absolute;top:639;left:94"><nobr><span class="ft5">These representation decisions are very near to the GHC</span></nobr></DIV>
<DIV style="position:absolute;top:654;left:81"><nobr><span class="ft10">implementation. In its runtime system all these elements<br>(stack, heap, node register and code) are present [9]. Our<br>closures are also a small simplification of theirs.</span></nobr></DIV>
<DIV style="position:absolute;top:699;left:94"><nobr><span class="ft5">In Figure 8, the ISTG machine instructions and its op-</span></nobr></DIV>
<DIV style="position:absolute;top:714;left:81"><nobr><span class="ft10">erational semantics are shown. The machine instructions<br>BUILDENV, PUSHALTS and UPDTMARK roughly cor-<br>respond to the three possible pushing actions of machine<br>STG-2. The SLIDE instruction has no clear correspondence<br>in the STG-2. As we will see in Section 5, it will be used<br>to change the current environment when a new closure is<br>entered. Instructions ALLOC and BUILDCLS will imple-<br>ment heap closure creation in the letrec rule of STG-2. Both<br>BUILDENV and BUILDCLS make use of a list of pairs, each<br>pair indicating whether the source variable is located in the<br>stack or in the current closure. Of course, it is not intended<br>this test to be done at runtime. An efficient translation of<br>these `machine' instructions to an imperative language will<br>generate the appropriate copy statement for each pair.</span></nobr></DIV>
<DIV style="position:absolute;top:925;left:94"><nobr><span class="ft5">Instructions ENTER and RETURNCON are typical of</span></nobr></DIV>
<DIV style="position:absolute;top:940;left:81"><nobr><span class="ft10">the actual STG machine as described in [6]. It is interesting<br>to note that it has been possible to describe our previous<br>STG machines without any reference to them. In our view,<br>they belong to ISTG, i.e. to a lower level of abstraction. Fi-<br>nally, instruction ARGCHECK, which implements updates<br>with lambda normal forms, is here at the same level of ab-<br>straction as RETURNCON, which implements updates with<br>constructions normal forms. Predefined code is stored in cs<br>for updating with a partial application and for blackholing</span></nobr></DIV>
<DIV style="position:absolute;top:398;left:475"><nobr><span class="ft10">a closure under evaluation. The corresponding code point-<br>ers are respectively called p</span></nobr></DIV>
<DIV style="position:absolute;top:411;left:647"><nobr><span class="ft1">n+1</span></nobr></DIV>
<DIV style="position:absolute;top:419;left:647"><nobr><span class="ft1">pap</span></nobr></DIV>
<DIV style="position:absolute;top:413;left:674"><nobr><span class="ft5">and p</span></nobr></DIV>
<DIV style="position:absolute;top:418;left:709"><nobr><span class="ft1">bh</span></nobr></DIV>
<DIV style="position:absolute;top:413;left:727"><nobr><span class="ft5">in Figure 8. The</span></nobr></DIV>
<DIV style="position:absolute;top:428;left:475"><nobr><span class="ft5">associated code is the following:</span></nobr></DIV>
<DIV style="position:absolute;top:451;left:482"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:456;left:489"><nobr><span class="ft1">bh</span></nobr></DIV>
<DIV style="position:absolute;top:451;left:524"><nobr><span class="ft5">= [ ]</span></nobr></DIV>
<DIV style="position:absolute;top:467;left:482"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:465;left:489"><nobr><span class="ft1">n+1</span></nobr></DIV>
<DIV style="position:absolute;top:473;left:489"><nobr><span class="ft1">pap</span></nobr></DIV>
<DIV style="position:absolute;top:467;left:524"><nobr><span class="ft5">= [BUILDENV [(NODE , 1), . . . , (NODE , n + 1) ],</span></nobr></DIV>
<DIV style="position:absolute;top:482;left:553"><nobr><span class="ft5">ENTER ]</span></nobr></DIV>
<DIV style="position:absolute;top:505;left:475"><nobr><span class="ft10">The code of a blackhole just blocks the machine as there<br>is no instruction to execute. There is predefined code for<br>partial applications with different values for n. The code<br>just copies the closure into the stack and jumps to the first<br>pointer that is assumed to be pointing to a -abstraction<br>closure.</span></nobr></DIV>
<DIV style="position:absolute;top:596;left:489"><nobr><span class="ft5">The translation to C of the 9 instructions of the ISTG</span></nobr></DIV>
<DIV style="position:absolute;top:611;left:475"><nobr><span class="ft10">should appear straightforward for the reader. For instance,<br>BUILDCLS and BUILDENV can be implemented by a se-<br>quence of assignments, copying values to/from the stack<br>an the heap; PUSHALTS, UPDTMARK and ENTER do<br>straightforward stack manipulation; SLIDE is more involved<br>but can be easily translated to a sequence of loops moving<br>information within the stack to collapse a number of stack<br>fragments. The more complex ones are RETURNCON and<br>ARGCHECK. Both contains a loop which updates the heap<br>with normal forms (respectively, constructions and partial<br>applications) as long as they encounter update marks in the<br>stack. Finally, the installation of a new instruction sequence<br>in the control made by ENTER and RETURNCON are im-<br>plemented by a simple jump.</span></nobr></DIV>
<DIV style="position:absolute;top:840;left:475"><nobr><span class="ft4"><b>5.</b></span></nobr></DIV>
<DIV style="position:absolute;top:840;left:507"><nobr><span class="ft12"><b>FORMAL TRANSLATION FROM STG-2<br>TO ISTG</b></span></nobr></DIV>
<DIV style="position:absolute;top:880;left:489"><nobr><span class="ft5">In this Section, we provide first the translation schemes for</span></nobr></DIV>
<DIV style="position:absolute;top:895;left:475"><nobr><span class="ft10">the FUN expressions and lambda forms and then prove that<br>this translation correctly implements the STG-2 machine on<br>top of the ISTG machine. Before embarking into the details,<br>we give some hints to intuitively understand the translation:</span></nobr></DIV>
<DIV style="position:absolute;top:965;left:495"><nobr><span class="ft5">· The ISTG stack will represent not only the STG-2</span></nobr></DIV>
<DIV style="position:absolute;top:980;left:509"><nobr><span class="ft10">stack, but also (part of) the current environment E<br>and all the environments associated to pending case<br>alternatives. So, care must be taken to distinguish be-<br>tween environments and other objects in the stack.</span></nobr></DIV>
<DIV style="position:absolute;top:1049;left:495"><nobr><span class="ft5">· The rest of the current environment E is kept in the</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:509"><nobr><span class="ft5">current closure. The translation knows where each free</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">107</span></nobr></DIV>
</DIV>
<!-- Page 7 -->
<a name="7"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="918" height="1188" src="95007.png" alt="background image">
<DIV style="position:absolute;top:80;left:166"><nobr><span class="ft5">Heap</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:342"><nobr><span class="ft5">Control</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:513"><nobr><span class="ft5">Environment</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:626"><nobr><span class="ft5">Stack</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:727"><nobr><span class="ft5">rule</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:114;left:342"><nobr><span class="ft5">letrec {x</span></nobr></DIV>
<DIV style="position:absolute;top:119;left:400"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:409"><nobr><span class="ft5">= lf</span></nobr></DIV>
<DIV style="position:absolute;top:121;left:434"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:443"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:113;left:446"><nobr><span class="ft1">t</span></nobr></DIV>
<DIV style="position:absolute;top:117;left:451"><nobr><span class="ft14">i</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:456"><nobr><span class="ft5">} in e</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:727"><nobr><span class="ft5">letrec (</span></nobr></DIV>
<DIV style="position:absolute;top:112;left:770"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:114;left:776"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:131;left:166"><nobr><span class="ft5">  [p</span></nobr></DIV>
<DIV style="position:absolute;top:136;left:201"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:209"><nobr><span class="ft5"> (lf</span></nobr></DIV>
<DIV style="position:absolute;top:138;left:243"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:248"><nobr><span class="ft5">, E |</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:277"><nobr><span class="ft1">t</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:281"><nobr><span class="ft14">i</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:286"><nobr><span class="ft5">)]</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:342"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:151;left:342"><nobr><span class="ft5">case e of alts |</span></nobr></DIV>
<DIV style="position:absolute;top:149;left:436"><nobr><span class="ft1">t</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:727"><nobr><span class="ft5">case1</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:167;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:167;left:342"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:626"><nobr><span class="ft5">(alts, E |</span></nobr></DIV>
<DIV style="position:absolute;top:165;left:680"><nobr><span class="ft1">t</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:685"><nobr><span class="ft5">) : S</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:166"><nobr><span class="ft5">[p  (C</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:222"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:234"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:242"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:246"><nobr><span class="ft5">, {x</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:267"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:276"><nobr><span class="ft5"> p</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:300"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:305"><nobr><span class="ft5">})]</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:342"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:513"><nobr><span class="ft5">E{x  p}</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:626"><nobr><span class="ft5">(alts, E ) : S</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:727"><nobr><span class="ft5">case2 (</span></nobr></DIV>
<DIV style="position:absolute;top:185;left:768"><nobr><span class="ft1">2</span></nobr></DIV>
<DIV style="position:absolute;top:187;left:775"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:202;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:202;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:202;left:342"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:348"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:202;left:513"><nobr><span class="ft5">E  {y</span></nobr></DIV>
<DIV style="position:absolute;top:208;left:557"><nobr><span class="ft1">ki</span></nobr></DIV>
<DIV style="position:absolute;top:202;left:571"><nobr><span class="ft5"> p</span></nobr></DIV>
<DIV style="position:absolute;top:207;left:596"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:202;left:601"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:202;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:222;left:342"><nobr><span class="ft5">e x</span></nobr></DIV>
<DIV style="position:absolute;top:227;left:361"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:513"><nobr><span class="ft5">E{x</span></nobr></DIV>
<DIV style="position:absolute;top:227;left:538"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:547"><nobr><span class="ft5"> p</span></nobr></DIV>
<DIV style="position:absolute;top:227;left:572"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:584"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:727"><nobr><span class="ft5">app1</span></nobr></DIV>
<DIV style="position:absolute;top:237;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:237;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:237;left:342"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:237;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:237;left:626"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:242;left:633"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:237;left:650"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:166"><nobr><span class="ft5">[p  (x</span></nobr></DIV>
<DIV style="position:absolute;top:261;left:228"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:241"><nobr><span class="ft5">.e, E )]</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:342"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:513"><nobr><span class="ft5">E{x  p}</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:626"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:261;left:633"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:650"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:727"><nobr><span class="ft5">app2</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:271;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:271;left:342"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:513"><nobr><span class="ft5">E  {x</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:558"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:566"><nobr><span class="ft5"> p</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:591"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:603"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:271;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:291;left:166"><nobr><span class="ft5">  [p  (e, E )]</span></nobr></DIV>
<DIV style="position:absolute;top:291;left:342"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:291;left:513"><nobr><span class="ft5">E{x  p}</span></nobr></DIV>
<DIV style="position:absolute;top:291;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:291;left:727"><nobr><span class="ft5">var1</span></nobr></DIV>
<DIV style="position:absolute;top:306;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:306;left:166"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:306;left:342"><nobr><span class="ft5">e</span></nobr></DIV>
<DIV style="position:absolute;top:306;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:306;left:626"><nobr><span class="ft5">#p : S</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:166"><nobr><span class="ft5">[p  (x</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:228"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:240"><nobr><span class="ft5">.y</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:259"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:271"><nobr><span class="ft5">.e, E )]</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:342"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:513"><nobr><span class="ft5">E{x  p}</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:626"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:633"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:649"><nobr><span class="ft5">: #q : S</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:727"><nobr><span class="ft5">var2 (</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:763"><nobr><span class="ft1">3</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:769"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:343;left:166"><nobr><span class="ft5">  [q  (x x</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:248"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:259"><nobr><span class="ft5">, E ])</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:342"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:626"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:633"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:649"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:363;left:166"><nobr><span class="ft5">[p  (C</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:222"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:363;left:234"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:368;left:242"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:363;left:246"><nobr><span class="ft5">, E )]</span></nobr></DIV>
<DIV style="position:absolute;top:363;left:342"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:363;left:513"><nobr><span class="ft5">E{x  p}</span></nobr></DIV>
<DIV style="position:absolute;top:363;left:626"><nobr><span class="ft5">#q : S</span></nobr></DIV>
<DIV style="position:absolute;top:363;left:727"><nobr><span class="ft5">var3</span></nobr></DIV>
<DIV style="position:absolute;top:378;left:135"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:378;left:166"><nobr><span class="ft5">  [q  (C</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:237"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:378;left:249"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:383;left:257"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:378;left:261"><nobr><span class="ft5">, E )]</span></nobr></DIV>
<DIV style="position:absolute;top:378;left:342"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:378;left:513"><nobr><span class="ft5">E</span></nobr></DIV>
<DIV style="position:absolute;top:378;left:626"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:133"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:412;left:138"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:145"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:166"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:173"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:182"><nobr><span class="ft5">are distinct and fresh w.r.t. , letrec {x</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:428"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:441"><nobr><span class="ft5">= lf</span></nobr></DIV>
<DIV style="position:absolute;top:422;left:471"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:476"><nobr><span class="ft5">} in e, and S. E = E  {x</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:641"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:649"><nobr><span class="ft5"> p</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:674"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:414;left:678"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:133"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:428;left:138"><nobr><span class="ft1">2</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:145"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:166"><nobr><span class="ft5">Expression e</span></nobr></DIV>
<DIV style="position:absolute;top:436;left:242"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:254"><nobr><span class="ft5">corresponds to alternative C</span></nobr></DIV>
<DIV style="position:absolute;top:436;left:426"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:437"><nobr><span class="ft5">y</span></nobr></DIV>
<DIV style="position:absolute;top:436;left:444"><nobr><span class="ft1">ki</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:459"><nobr><span class="ft5"> e</span></nobr></DIV>
<DIV style="position:absolute;top:436;left:483"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:430;left:494"><nobr><span class="ft5">in alts</span></nobr></DIV>
<DIV style="position:absolute;top:447;left:133"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:445;left:138"><nobr><span class="ft1">3</span></nobr></DIV>
<DIV style="position:absolute;top:447;left:145"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:447;left:166"><nobr><span class="ft5">E = {x  p, x</span></nobr></DIV>
<DIV style="position:absolute;top:452;left:260"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:447;left:269"><nobr><span class="ft5"> p</span></nobr></DIV>
<DIV style="position:absolute;top:452;left:293"><nobr><span class="ft1">ik</span></nobr></DIV>
<DIV style="position:absolute;top:447;left:305"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:491;left:352"><nobr><span class="ft5">Figure 7: The STG-2 machine</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:114"><nobr><span class="ft10">variable is located by maintaining two compile-time<br>environments  and . The first one  corresponds to<br>the environment kept in the stack, while the second one<br> corresponds to the free variables accessed through<br>the node pointer.</span></nobr></DIV>
<DIV style="position:absolute;top:620;left:101"><nobr><span class="ft5">· The stack can be considered as divided into big blocks</span></nobr></DIV>
<DIV style="position:absolute;top:635;left:114"><nobr><span class="ft10">separated by code pointers p pointing to case alter-<br>natives. Each big block topped with such a pointer<br>corresponds to the environment of the associated al-<br>ternatives.</span></nobr></DIV>
<DIV style="position:absolute;top:704;left:101"><nobr><span class="ft5">· In turn, each big block can be considered as divided</span></nobr></DIV>
<DIV style="position:absolute;top:719;left:114"><nobr><span class="ft10">into small blocks, each one topped with a set of ar-<br>guments of pending applications. The compile-time<br>environment  is likewise divided into big and small<br>blocks, so reflecting the stack structure.</span></nobr></DIV>
<DIV style="position:absolute;top:789;left:101"><nobr><span class="ft5">· When a variable is reached in the current instruction</span></nobr></DIV>
<DIV style="position:absolute;top:804;left:114"><nobr><span class="ft10">sequence, an ENTER instruction is executed. This<br>will finish the current sequence and start a new one.<br>The upper big block of the stack must be deleted (cor-<br>responding to changing the current environment) but<br>arguments of pending applications must be kept. This<br>stack restructuring is accomplished by a SLIDE oper-<br>ation with an appropriate argument.</span></nobr></DIV>
<DIV style="position:absolute;top:919;left:96"><nobr><span class="ft5">Definition 2. A stack environment  is a list [(</span></nobr></DIV>
<DIV style="position:absolute;top:925;left:377"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:919;left:384"><nobr><span class="ft5">, m</span></nobr></DIV>
<DIV style="position:absolute;top:925;left:402"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:919;left:409"><nobr><span class="ft5">, n</span></nobr></DIV>
<DIV style="position:absolute;top:925;left:423"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:919;left:430"><nobr><span class="ft5">),</span></nobr></DIV>
<DIV style="position:absolute;top:934;left:81"><nobr><span class="ft5">. . . , (</span></nobr></DIV>
<DIV style="position:absolute;top:940;left:117"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:934;left:123"><nobr><span class="ft5">, m</span></nobr></DIV>
<DIV style="position:absolute;top:940;left:141"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:934;left:148"><nobr><span class="ft5">, n</span></nobr></DIV>
<DIV style="position:absolute;top:940;left:162"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:934;left:168"><nobr><span class="ft5">)] of blocks. It describes the variables in the</span></nobr></DIV>
<DIV style="position:absolute;top:949;left:81"><nobr><span class="ft10">stack starting from the top. In a block (, m, n),  is an<br>environment mapping exactly m- | n | program variables<br>to disjoint numbers in the range 1..m- | n |. The empty<br>environment, denoted </span></nobr></DIV>
<DIV style="position:absolute;top:1000;left:223"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:994;left:235"><nobr><span class="ft5">is the list [({}, 0, 0)].</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:94"><nobr><span class="ft5">A block (, m, n) corresponds to a small block in the above</span></nobr></DIV>
<DIV style="position:absolute;top:1034;left:81"><nobr><span class="ft10">explanation. Blocks with n = -1, are topped with a code<br>pointer pointing to alternatives. So, they provide a separa-<br>tion between big blocks. The upper big block consists of all</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:475"><nobr><span class="ft10">the small blocks up to (and excluding) the first small block<br>with n = -1. Blocks with n &gt; 0 have m - n free variables<br>and are topped with n arguments of pending applications.<br>The upper block is the only one with n = 0 meaning that it<br>is not still closed and that it can be extended.</span></nobr></DIV>
<DIV style="position:absolute;top:625;left:490"><nobr><span class="ft5">Definition 3. A closure environment  with n variables is</span></nobr></DIV>
<DIV style="position:absolute;top:640;left:475"><nobr><span class="ft10">a mapping from these variables to disjoint numbers in the<br>range 1..n.</span></nobr></DIV>
<DIV style="position:absolute;top:684;left:490"><nobr><span class="ft5">Definition 4. The offset of a variable x in  from the top</span></nobr></DIV>
<DIV style="position:absolute;top:699;left:475"><nobr><span class="ft5">of the stack, denoted  x, is given by</span></nobr></DIV>
<DIV style="position:absolute;top:736;left:530"><nobr><span class="ft5"> x</span></nobr></DIV>
<DIV style="position:absolute;top:731;left:550"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:736;left:552"><nobr><span class="ft5">= (</span></nobr></DIV>
<DIV style="position:absolute;top:723;left:578"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:756;left:573"><nobr><span class="ft1">i=l</span></nobr></DIV>
<DIV style="position:absolute;top:736;left:593"><nobr><span class="ft5">m</span></nobr></DIV>
<DIV style="position:absolute;top:742;left:605"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:736;left:610"><nobr><span class="ft5">) - </span></nobr></DIV>
<DIV style="position:absolute;top:742;left:638"><nobr><span class="ft1">l</span></nobr></DIV>
<DIV style="position:absolute;top:736;left:647"><nobr><span class="ft5">x, being x  dom </span></nobr></DIV>
<DIV style="position:absolute;top:742;left:774"><nobr><span class="ft1">l</span></nobr></DIV>
<DIV style="position:absolute;top:778;left:489"><nobr><span class="ft5">If the initial closed expression to be translated has differ-</span></nobr></DIV>
<DIV style="position:absolute;top:793;left:475"><nobr><span class="ft10">ent names for bound variables, then the compile time envi-<br>ronments  and  will never have duplicate names. It will be<br>proved below that every free variable of an expression being<br>compiled will necessarily be either in  or in , and never in<br>both. This allows us to introduce the notation (, ) x to<br>mean</span></nobr></DIV>
<DIV style="position:absolute;top:899;left:519"><nobr><span class="ft5">(, ) x</span></nobr></DIV>
<DIV style="position:absolute;top:894;left:563"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:899;left:565"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:891;left:598"><nobr><span class="ft5">(STACK ,  x)</span></nobr></DIV>
<DIV style="position:absolute;top:891;left:706"><nobr><span class="ft5">if x  dom </span></nobr></DIV>
<DIV style="position:absolute;top:906;left:598"><nobr><span class="ft5">(NODE ,  x)</span></nobr></DIV>
<DIV style="position:absolute;top:906;left:706"><nobr><span class="ft5">if x  dom </span></nobr></DIV>
<DIV style="position:absolute;top:931;left:489"><nobr><span class="ft5">The stack environment may suffer a number of operations:</span></nobr></DIV>
<DIV style="position:absolute;top:947;left:475"><nobr><span class="ft10">closing the current small block with a set of arguments, en-<br>larging the current small block with new bindings, and clos-<br>ing the current big block with a pointer to case alternatives.<br>These are formally defined as follows.</span></nobr></DIV>
<DIV style="position:absolute;top:1021;left:490"><nobr><span class="ft5">Definition 5. The following operations with stack envi-</span></nobr></DIV>
<DIV style="position:absolute;top:1036;left:475"><nobr><span class="ft5">ronments are defined:</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:491"><nobr><span class="ft5">1. ((, m, 0) : ) + n</span></nobr></DIV>
<DIV style="position:absolute;top:1059;left:616"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:619"><nobr><span class="ft5">= ({}, 0, 0) : (, m + n, n) : </span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">108</span></nobr></DIV>
</DIV>
<!-- Page 8 -->
<a name="8"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="918" height="1188" src="95008.png" alt="background image">
<DIV style="position:absolute;top:80;left:158"><nobr><span class="ft5">Instructions</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:313"><nobr><span class="ft5">Stack</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:435"><nobr><span class="ft5">Node</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:482"><nobr><span class="ft5">Heap</span></nobr></DIV>
<DIV style="position:absolute;top:80;left:653"><nobr><span class="ft5">Code</span></nobr></DIV>
<DIV style="position:absolute;top:107;left:89"><nobr><span class="ft5">control</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:158"><nobr><span class="ft5">[ENTER]</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:313"><nobr><span class="ft5">a : S</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:482"><nobr><span class="ft5">[a  (p, ws)]</span></nobr></DIV>
<DIV style="position:absolute;top:122;left:653"><nobr><span class="ft5">cs[p  is]</span></nobr></DIV>
<DIV style="position:absolute;top:137;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:137;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:137;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:137;left:435"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:137;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:137;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:158"><nobr><span class="ft5">[RETURNCON C</span></nobr></DIV>
<DIV style="position:absolute;top:160;left:270"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:169;left:269"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:281"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:313"><nobr><span class="ft5">p : S</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:162;left:653"><nobr><span class="ft5">cs[p  is</span></nobr></DIV>
<DIV style="position:absolute;top:167;left:709"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:158;left:714"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:722"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:177;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:177;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:182;left:169"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:177;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:177;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:177;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:177;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:201;left:158"><nobr><span class="ft5">[RETURNCON C</span></nobr></DIV>
<DIV style="position:absolute;top:199;left:270"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:207;left:269"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:201;left:281"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:201;left:313"><nobr><span class="ft5">#a : S</span></nobr></DIV>
<DIV style="position:absolute;top:201;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:201;left:482"><nobr><span class="ft5">[a  (p</span></nobr></DIV>
<DIV style="position:absolute;top:206;left:536"><nobr><span class="ft1">bh</span></nobr></DIV>
<DIV style="position:absolute;top:201;left:548"><nobr><span class="ft5">, as),</span></nobr></DIV>
<DIV style="position:absolute;top:216;left:496"><nobr><span class="ft5">node  (p, ws)]</span></nobr></DIV>
<DIV style="position:absolute;top:216;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:158"><nobr><span class="ft5">[RETURNCON C</span></nobr></DIV>
<DIV style="position:absolute;top:229;left:270"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:237;left:269"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:281"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:482"><nobr><span class="ft5">[a  (p, ws)]</span></nobr></DIV>
<DIV style="position:absolute;top:231;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:254;left:158"><nobr><span class="ft5">ARGCHECK m : is</span></nobr></DIV>
<DIV style="position:absolute;top:254;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:260;left:321"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:254;left:340"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:254;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:254;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:254;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:269;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:269;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:269;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:275;left:321"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:269;left:340"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:269;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:269;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:269;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:158"><nobr><span class="ft5">ARGCHECK m : is</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:298;left:321"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:337"><nobr><span class="ft5">: #a : S</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:482"><nobr><span class="ft5">[a  (p</span></nobr></DIV>
<DIV style="position:absolute;top:298;left:541"><nobr><span class="ft1">bh</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:553"><nobr><span class="ft5">, ws)]</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:742"><nobr><span class="ft5">n &lt; m</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:158"><nobr><span class="ft5">ARGCHECK m : is</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:314;left:321"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:337"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:482"><nobr><span class="ft5">[a  (p</span></nobr></DIV>
<DIV style="position:absolute;top:307;left:536"><nobr><span class="ft1">n+1</span></nobr></DIV>
<DIV style="position:absolute;top:315;left:536"><nobr><span class="ft1">pap</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:557"><nobr><span class="ft5">, node : a</span></nobr></DIV>
<DIV style="position:absolute;top:314;left:611"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:623"><nobr><span class="ft5">)]</span></nobr></DIV>
<DIV style="position:absolute;top:309;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:99"><nobr><span class="ft5">heap</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:158"><nobr><span class="ft5">ALLOC m : is</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:348;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:742"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:347;left:747"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:348;left:753"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:364;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:364;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:364;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:369;left:321"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:364;left:335"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:364;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:364;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:364;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:388;left:158"><nobr><span class="ft5">BUILDCLS i p z</span></nobr></DIV>
<DIV style="position:absolute;top:393;left:262"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:388;left:279"><nobr><span class="ft5">: is</span></nobr></DIV>
<DIV style="position:absolute;top:388;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:388;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:388;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:388;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:388;left:742"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:386;left:747"><nobr><span class="ft1">2</span></nobr></DIV>
<DIV style="position:absolute;top:388;left:753"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:403;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:403;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:403;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:403;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:403;left:482"><nobr><span class="ft5">[S!i  (p, a</span></nobr></DIV>
<DIV style="position:absolute;top:409;left:560"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:403;left:572"><nobr><span class="ft5">)]</span></nobr></DIV>
<DIV style="position:absolute;top:403;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:427;left:98"><nobr><span class="ft5">stack</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:158"><nobr><span class="ft5">BUILDENV z</span></nobr></DIV>
<DIV style="position:absolute;top:448;left:246"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:262"><nobr><span class="ft5">: is</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:443;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:742"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:441;left:747"><nobr><span class="ft1">2</span></nobr></DIV>
<DIV style="position:absolute;top:443;left:753"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:458;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:458;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:458;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:463;left:321"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:458;left:337"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:458;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:458;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:458;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:481;left:158"><nobr><span class="ft5">PUSHALTS p : is</span></nobr></DIV>
<DIV style="position:absolute;top:481;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:481;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:481;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:481;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:497;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:497;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:497;left:313"><nobr><span class="ft5">p : S</span></nobr></DIV>
<DIV style="position:absolute;top:497;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:497;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:497;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:520;left:158"><nobr><span class="ft5">UPDTMARK : is</span></nobr></DIV>
<DIV style="position:absolute;top:520;left:313"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:520;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:520;left:482"><nobr><span class="ft5">[node  (p, ws)]</span></nobr></DIV>
<DIV style="position:absolute;top:520;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:313"><nobr><span class="ft5">#node : S</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:482"><nobr><span class="ft5">[node  (p</span></nobr></DIV>
<DIV style="position:absolute;top:541;left:557"><nobr><span class="ft1">bh</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:569"><nobr><span class="ft5">, ws)]</span></nobr></DIV>
<DIV style="position:absolute;top:535;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:158"><nobr><span class="ft5">SLIDE (n</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:220"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:226"><nobr><span class="ft5">, m</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:245"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:252"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:560;left:257"><nobr><span class="ft1">l</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:265"><nobr><span class="ft5">: is</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:321"><nobr><span class="ft1">kj n</span></nobr></DIV>
<DIV style="position:absolute;top:568;left:340"><nobr><span class="ft14">k</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:351"><nobr><span class="ft5">: b</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:364"><nobr><span class="ft1">kj</span></nobr></DIV>
<DIV style="position:absolute;top:561;left:376"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:565;left:386"><nobr><span class="ft14">k</span></nobr></DIV>
<DIV style="position:absolute;top:558;left:393"><nobr><span class="ft1">l</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:402"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:566;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:566;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:585;left:104"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:585;left:158"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:585;left:313"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:590;left:321"><nobr><span class="ft1">kj n</span></nobr></DIV>
<DIV style="position:absolute;top:587;left:340"><nobr><span class="ft14">k</span></nobr></DIV>
<DIV style="position:absolute;top:580;left:347"><nobr><span class="ft1">l</span></nobr></DIV>
<DIV style="position:absolute;top:585;left:355"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:585;left:435"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:585;left:482"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:585;left:653"><nobr><span class="ft5">cs</span></nobr></DIV>
<DIV style="position:absolute;top:625;left:107"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:623;left:112"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:625;left:118"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:625;left:158"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:630;left:165"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:625;left:181"><nobr><span class="ft5">is a pointer to a new closure with space for m free variables, and  is the resulting</span></nobr></DIV>
<DIV style="position:absolute;top:640;left:158"><nobr><span class="ft5">heap after the allocation</span></nobr></DIV>
<DIV style="position:absolute;top:664;left:107"><nobr><span class="ft5">(</span></nobr></DIV>
<DIV style="position:absolute;top:662;left:112"><nobr><span class="ft1">2</span></nobr></DIV>
<DIV style="position:absolute;top:664;left:118"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:664;left:158"><nobr><span class="ft5">a</span></nobr></DIV>
<DIV style="position:absolute;top:669;left:165"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:664;left:174"><nobr><span class="ft5">=</span></nobr></DIV>
<DIV style="position:absolute;top:656;left:206"><nobr><span class="ft5">S!i</span></nobr></DIV>
<DIV style="position:absolute;top:656;left:273"><nobr><span class="ft5">if z</span></nobr></DIV>
<DIV style="position:absolute;top:661;left:292"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:656;left:301"><nobr><span class="ft5">= (STACK , i)</span></nobr></DIV>
<DIV style="position:absolute;top:671;left:206"><nobr><span class="ft5">node</span></nobr></DIV>
<DIV style="position:absolute;top:676;left:234"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:671;left:242"><nobr><span class="ft5">!i</span></nobr></DIV>
<DIV style="position:absolute;top:671;left:273"><nobr><span class="ft5">if z</span></nobr></DIV>
<DIV style="position:absolute;top:676;left:292"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:671;left:301"><nobr><span class="ft5">= (NODE , i)</span></nobr></DIV>
<DIV style="position:absolute;top:702;left:356"><nobr><span class="ft5">Figure 8: The ISTG machine</span></nobr></DIV>
<DIV style="position:absolute;top:748;left:97"><nobr><span class="ft5">2. ((, m, 0) : )+({x</span></nobr></DIV>
<DIV style="position:absolute;top:754;left:224"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:748;left:233"><nobr><span class="ft5"> j</span></nobr></DIV>
<DIV style="position:absolute;top:754;left:256"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:744;left:261"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:748;left:268"><nobr><span class="ft5">}, n)</span></nobr></DIV>
<DIV style="position:absolute;top:743;left:299"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:748;left:301"><nobr><span class="ft5">= ({x</span></nobr></DIV>
<DIV style="position:absolute;top:754;left:355"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:748;left:364"><nobr><span class="ft5"> m + j</span></nobr></DIV>
<DIV style="position:absolute;top:754;left:416"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:744;left:421"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:748;left:429"><nobr><span class="ft5">},</span></nobr></DIV>
<DIV style="position:absolute;top:763;left:369"><nobr><span class="ft5">m+n, 0) : </span></nobr></DIV>
<DIV style="position:absolute;top:795;left:97"><nobr><span class="ft5">3. ((, m, 0) : )</span></nobr></DIV>
<DIV style="position:absolute;top:793;left:192"><nobr><span class="ft1">+</span></nobr></DIV>
<DIV style="position:absolute;top:793;left:194"><nobr><span class="ft1">+</span></nobr></DIV>
<DIV style="position:absolute;top:790;left:208"><nobr><span class="ft13">def</span></nobr></DIV>
<DIV style="position:absolute;top:795;left:211"><nobr><span class="ft5">= ({}, 0, 0) : (, m + 1, -1) : </span></nobr></DIV>
<DIV style="position:absolute;top:823;left:81"><nobr><span class="ft4"><b>5.1</b></span></nobr></DIV>
<DIV style="position:absolute;top:823;left:121"><nobr><span class="ft4"><b>Translation schemes</b></span></nobr></DIV>
<DIV style="position:absolute;top:842;left:94"><nobr><span class="ft5">Functions trE and trA respectively translate a FUN ex-</span></nobr></DIV>
<DIV style="position:absolute;top:857;left:81"><nobr><span class="ft10">pression and a case alternative to a sequence of ISTG ma-<br>chine instructions; function trAs translates a set of alterna-<br>tives to a pointer to a vectored set of machine instruction<br>sequences in the code store; and function trB translates a<br>lambda form to a pointer to a machine instruction sequence<br>in the code store. The translation schemes are shown in<br>Figure 9.</span></nobr></DIV>
<DIV style="position:absolute;top:962;left:94"><nobr><span class="ft5">The notation . . . &amp; cs[p  . . .] means that the corre-</span></nobr></DIV>
<DIV style="position:absolute;top:977;left:81"><nobr><span class="ft10">sponding translation scheme has a side effect which consists<br>of creating a code sequence in the code store cs and pointing<br>it by the code pointer p.</span></nobr></DIV>
<DIV style="position:absolute;top:1034;left:96"><nobr><span class="ft5">Proposition 8. (static invariant) Given a closed expres-</span></nobr></DIV>
<DIV style="position:absolute;top:1049;left:81"><nobr><span class="ft5">sion e</span></nobr></DIV>
<DIV style="position:absolute;top:1055;left:119"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:1049;left:133"><nobr><span class="ft5">with different bound variables and an initial call</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:81"><nobr><span class="ft5">trE e</span></nobr></DIV>
<DIV style="position:absolute;top:1070;left:113"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:125"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:1070;left:132"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:143"><nobr><span class="ft5">{}, in all internal calls of the form trE e  :</span></nobr></DIV>
<DIV style="position:absolute;top:747;left:491"><nobr><span class="ft5">1. The stack environment has the form  = (, m, 0) :  .</span></nobr></DIV>
<DIV style="position:absolute;top:762;left:509"><nobr><span class="ft10">Moreover, there is no other block ( , m , n) in  with<br>n = 0. Consequently, all environment operations in<br>the above translation are well defined.</span></nobr></DIV>
<DIV style="position:absolute;top:819;left:491"><nobr><span class="ft5">2. All free variables of e are defined either in  or in .</span></nobr></DIV>
<DIV style="position:absolute;top:834;left:509"><nobr><span class="ft5">Moreover, dom   dom  = .</span></nobr></DIV>
<DIV style="position:absolute;top:861;left:491"><nobr><span class="ft5">3. The last instruction generated for e is ENTER. Con-</span></nobr></DIV>
<DIV style="position:absolute;top:876;left:509"><nobr><span class="ft10">sequently, the main instruction sequence and all se-<br>quences corresponding to case alternatives and to non-<br>constructor closures, end in an ENTER.</span></nobr></DIV>
<DIV style="position:absolute;top:930;left:490"><nobr><span class="ft5">Proof. (1) and (2) are proved by induction on the tree</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:475"><nobr><span class="ft10">structure of calls to trE ; (3) is proved by structural induc-<br>tion on FUN expressions.</span></nobr></DIV>
<DIV style="position:absolute;top:989;left:489"><nobr><span class="ft5">In order to prove the correctness of the translation, we</span></nobr></DIV>
<DIV style="position:absolute;top:1004;left:475"><nobr><span class="ft10">only need to consider ISTG machine configurations of the<br>form (is, S</span></nobr></DIV>
<DIV style="position:absolute;top:1025;left:539"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:546"><nobr><span class="ft5">, node, </span></nobr></DIV>
<DIV style="position:absolute;top:1025;left:595"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:601"><nobr><span class="ft5">, cs) in which is is generated by a call</span></nobr></DIV>
<DIV style="position:absolute;top:1034;left:475"><nobr><span class="ft10">to trE for some expression e and environments , . We call<br>these stable configurations. We enrich then these configura-<br>tions with three additional components: the environments</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">109</span></nobr></DIV>
</DIV>
<!-- Page 9 -->
<a name="9"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="918" height="1188" src="95009.png" alt="background image">
<DIV style="position:absolute;top:82;left:81"><nobr><span class="ft5">trE (e x</span></nobr></DIV>
<DIV style="position:absolute;top:88;left:131"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:82;left:143"><nobr><span class="ft5">)  </span></nobr></DIV>
<DIV style="position:absolute;top:82;left:316"><nobr><span class="ft5">= [BUILDENV (, ) x</span></nobr></DIV>
<DIV style="position:absolute;top:88;left:463"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:77;left:468"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:82;left:476"><nobr><span class="ft5">] ++</span></nobr></DIV>
<DIV style="position:absolute;top:97;left:334"><nobr><span class="ft5">trE e ( + n) </span></nobr></DIV>
<DIV style="position:absolute;top:130;left:81"><nobr><span class="ft5">trE (case e of alts |</span></nobr></DIV>
<DIV style="position:absolute;top:128;left:206"><nobr><span class="ft1">x</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:212"><nobr><span class="ft14">in</span></nobr></DIV>
<DIV style="position:absolute;top:130;left:225"><nobr><span class="ft5">)  </span></nobr></DIV>
<DIV style="position:absolute;top:130;left:316"><nobr><span class="ft5">= [BUILDENV zs, PUSHALTS p] ++ trE e </span></nobr></DIV>
<DIV style="position:absolute;top:127;left:601"><nobr><span class="ft1">+</span></nobr></DIV>
<DIV style="position:absolute;top:127;left:604"><nobr><span class="ft1">+</span></nobr></DIV>
<DIV style="position:absolute;top:130;left:618"><nobr><span class="ft5">( - xs)</span></nobr></DIV>
<DIV style="position:absolute;top:160;left:131"><nobr><span class="ft5">where p</span></nobr></DIV>
<DIV style="position:absolute;top:160;left:265"><nobr><span class="ft5">= trAs alts </span></nobr></DIV>
<DIV style="position:absolute;top:176;left:177"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:176;left:265"><nobr><span class="ft5">=  + ({xs</span></nobr></DIV>
<DIV style="position:absolute;top:182;left:333"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:343"><nobr><span class="ft5"> m - j + 1</span></nobr></DIV>
<DIV style="position:absolute;top:172;left:420"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:176;left:430"><nobr><span class="ft5">}, m)</span></nobr></DIV>
<DIV style="position:absolute;top:191;left:177"><nobr><span class="ft5">xs</span></nobr></DIV>
<DIV style="position:absolute;top:191;left:265"><nobr><span class="ft5">= [x | x  x</span></nobr></DIV>
<DIV style="position:absolute;top:197;left:344"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:191;left:359"><nobr><span class="ft5"> x  dom ]</span></nobr></DIV>
<DIV style="position:absolute;top:207;left:177"><nobr><span class="ft5">zs</span></nobr></DIV>
<DIV style="position:absolute;top:207;left:265"><nobr><span class="ft5">= [(node,  x) | x  xs]</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:177"><nobr><span class="ft5">m</span></nobr></DIV>
<DIV style="position:absolute;top:222;left:265"><nobr><span class="ft5">= | xs |</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:81"><nobr><span class="ft5">trE (letrec x</span></nobr></DIV>
<DIV style="position:absolute;top:261;left:163"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:172"><nobr><span class="ft5">= lf</span></nobr></DIV>
<DIV style="position:absolute;top:263;left:197"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:206"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:255;left:210"><nobr><span class="ft1">y</span></nobr></DIV>
<DIV style="position:absolute;top:258;left:215"><nobr><span class="ft14">ij mi</span></nobr></DIV>
<DIV style="position:absolute;top:249;left:240"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:252"><nobr><span class="ft5">in e)   = [ALLOC m</span></nobr></DIV>
<DIV style="position:absolute;top:261;left:405"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:412"><nobr><span class="ft5">, . . . , ALLOC m</span></nobr></DIV>
<DIV style="position:absolute;top:261;left:510"><nobr><span class="ft1">1</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:516"><nobr><span class="ft5">] ++</span></nobr></DIV>
<DIV style="position:absolute;top:273;left:334"><nobr><span class="ft5">[BUILDCLS (i - 1) p</span></nobr></DIV>
<DIV style="position:absolute;top:278;left:466"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:273;left:475"><nobr><span class="ft5">zs</span></nobr></DIV>
<DIV style="position:absolute;top:278;left:487"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:268;left:492"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:273;left:500"><nobr><span class="ft5">] ++</span></nobr></DIV>
<DIV style="position:absolute;top:288;left:339"><nobr><span class="ft5">trE e  </span></nobr></DIV>
<DIV style="position:absolute;top:320;left:131"><nobr><span class="ft5">where </span></nobr></DIV>
<DIV style="position:absolute;top:320;left:265"><nobr><span class="ft5">=  + ({x</span></nobr></DIV>
<DIV style="position:absolute;top:325;left:328"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:320;left:336"><nobr><span class="ft5"> n - i + 1</span></nobr></DIV>
<DIV style="position:absolute;top:316;left:408"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:320;left:415"><nobr><span class="ft5">}, n)</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:177"><nobr><span class="ft5">p</span></nobr></DIV>
<DIV style="position:absolute;top:342;left:184"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:265"><nobr><span class="ft5">= trB (lf</span></nobr></DIV>
<DIV style="position:absolute;top:344;left:326"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:334"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:335;left:338"><nobr><span class="ft1">y</span></nobr></DIV>
<DIV style="position:absolute;top:338;left:344"><nobr><span class="ft14">ij mi</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:369"><nobr><span class="ft5">),</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:403"><nobr><span class="ft5">i  {1..n}</span></nobr></DIV>
<DIV style="position:absolute;top:355;left:177"><nobr><span class="ft5">zs</span></nobr></DIV>
<DIV style="position:absolute;top:360;left:190"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:355;left:265"><nobr><span class="ft5">= ( , ) y</span></nobr></DIV>
<DIV style="position:absolute;top:360;left:330"><nobr><span class="ft1">ij</span></nobr></DIV>
<DIV style="position:absolute;top:349;left:340"><nobr><span class="ft1">m</span></nobr></DIV>
<DIV style="position:absolute;top:352;left:350"><nobr><span class="ft14">i</span></nobr></DIV>
<DIV style="position:absolute;top:355;left:355"><nobr><span class="ft5">,</span></nobr></DIV>
<DIV style="position:absolute;top:355;left:385"><nobr><span class="ft5">i  {1..n}</span></nobr></DIV>
<DIV style="position:absolute;top:385;left:81"><nobr><span class="ft5">trE x  </span></nobr></DIV>
<DIV style="position:absolute;top:385;left:316"><nobr><span class="ft5">= [BUILDENV [(, ) x],</span></nobr></DIV>
<DIV style="position:absolute;top:400;left:339"><nobr><span class="ft10">SLIDE ((1, 0) : ms),<br>ENTER]</span></nobr></DIV>
<DIV style="position:absolute;top:445;left:131"><nobr><span class="ft5">where ms</span></nobr></DIV>
<DIV style="position:absolute;top:445;left:265"><nobr><span class="ft5">= map (\( , m, n)  (n, m - n)) (takeWhile nn )</span></nobr></DIV>
<DIV style="position:absolute;top:460;left:177"><nobr><span class="ft10">nn ( , m, -1) = False<br>nn</span></nobr></DIV>
<DIV style="position:absolute;top:475;left:265"><nobr><span class="ft5">= True</span></nobr></DIV>
<DIV style="position:absolute;top:507;left:81"><nobr><span class="ft5">trAs (alt</span></nobr></DIV>
<DIV style="position:absolute;top:512;left:135"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:502;left:139"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:507;left:147"><nobr><span class="ft5">) </span></nobr></DIV>
<DIV style="position:absolute;top:507;left:283"><nobr><span class="ft5">= p &amp; cs[p  trA alt</span></nobr></DIV>
<DIV style="position:absolute;top:512;left:421"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:507;left:430"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:502;left:437"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:507;left:445"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:81"><nobr><span class="ft5">trA (C x</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:135"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:151"><nobr><span class="ft5"> e) </span></nobr></DIV>
<DIV style="position:absolute;top:539;left:283"><nobr><span class="ft5">= trE e  {x</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:362"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:370"><nobr><span class="ft5"> i</span></nobr></DIV>
<DIV style="position:absolute;top:534;left:392"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:539;left:400"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:81"><nobr><span class="ft5">trB (C</span></nobr></DIV>
<DIV style="position:absolute;top:569;left:123"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:577;left:122"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:135"><nobr><span class="ft5">x</span></nobr></DIV>
<DIV style="position:absolute;top:576;left:143"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:159"><nobr><span class="ft5">|</span></nobr></DIV>
<DIV style="position:absolute;top:569;left:163"><nobr><span class="ft1">x</span></nobr></DIV>
<DIV style="position:absolute;top:572;left:169"><nobr><span class="ft14">in</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:182"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:283"><nobr><span class="ft5">= p &amp; cs[p  [RETURNCON C</span></nobr></DIV>
<DIV style="position:absolute;top:569;left:491"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:577;left:490"><nobr><span class="ft1">k</span></nobr></DIV>
<DIV style="position:absolute;top:571;left:499"><nobr><span class="ft5">]]</span></nobr></DIV>
<DIV style="position:absolute;top:603;left:81"><nobr><span class="ft5">trB (x</span></nobr></DIV>
<DIV style="position:absolute;top:608;left:128"><nobr><span class="ft1">il</span></nobr></DIV>
<DIV style="position:absolute;top:603;left:137"><nobr><span class="ft5">.e |</span></nobr></DIV>
<DIV style="position:absolute;top:601;left:155"><nobr><span class="ft1">y</span></nobr></DIV>
<DIV style="position:absolute;top:604;left:161"><nobr><span class="ft14">j n</span></nobr></DIV>
<DIV style="position:absolute;top:603;left:174"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:603;left:283"><nobr><span class="ft5">= p &amp; cs[p  [ARGCHECK l] ++ trE e  ]</span></nobr></DIV>
<DIV style="position:absolute;top:637;left:131"><nobr><span class="ft5">where </span></nobr></DIV>
<DIV style="position:absolute;top:637;left:265"><nobr><span class="ft5">= [({x</span></nobr></DIV>
<DIV style="position:absolute;top:643;left:307"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:637;left:316"><nobr><span class="ft5"> l - i + 1</span></nobr></DIV>
<DIV style="position:absolute;top:633;left:383"><nobr><span class="ft1">l</span></nobr></DIV>
<DIV style="position:absolute;top:637;left:388"><nobr><span class="ft5">}, l, 0)]</span></nobr></DIV>
<DIV style="position:absolute;top:654;left:177"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:654;left:265"><nobr><span class="ft5">= {y</span></nobr></DIV>
<DIV style="position:absolute;top:659;left:297"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:654;left:307"><nobr><span class="ft5"> j</span></nobr></DIV>
<DIV style="position:absolute;top:650;left:331"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:654;left:339"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:686;left:81"><nobr><span class="ft5">trB (e |</span></nobr></DIV>
<DIV style="position:absolute;top:684;left:126"><nobr><span class="ft1">y</span></nobr></DIV>
<DIV style="position:absolute;top:687;left:132"><nobr><span class="ft14">j n</span></nobr></DIV>
<DIV style="position:absolute;top:686;left:146"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:686;left:283"><nobr><span class="ft5">= p &amp; cs[p  [UPDTMARK ] ++ trE e </span></nobr></DIV>
<DIV style="position:absolute;top:692;left:541"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:686;left:552"><nobr><span class="ft5">]</span></nobr></DIV>
<DIV style="position:absolute;top:718;left:131"><nobr><span class="ft5">where </span></nobr></DIV>
<DIV style="position:absolute;top:718;left:265"><nobr><span class="ft5">= {y</span></nobr></DIV>
<DIV style="position:absolute;top:723;left:297"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:718;left:307"><nobr><span class="ft5"> j</span></nobr></DIV>
<DIV style="position:absolute;top:713;left:331"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:718;left:339"><nobr><span class="ft5">}</span></nobr></DIV>
<DIV style="position:absolute;top:761;left:276"><nobr><span class="ft5">Figure 9: Translation schemes from STG-2 to ISTG</span></nobr></DIV>
<DIV style="position:absolute;top:806;left:81"><nobr><span class="ft5"> and  used to generate is, and an environment stack S</span></nobr></DIV>
<DIV style="position:absolute;top:811;left:422"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:821;left:81"><nobr><span class="ft10">containing a sequence of stack environments. The environ-<br>ments in S</span></nobr></DIV>
<DIV style="position:absolute;top:841;left:147"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:836;left:170"><nobr><span class="ft5">are in one to one correspondence with case</span></nobr></DIV>
<DIV style="position:absolute;top:851;left:81"><nobr><span class="ft5">pointers stored in S</span></nobr></DIV>
<DIV style="position:absolute;top:856;left:204"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:851;left:211"><nobr><span class="ft5">. Initially S</span></nobr></DIV>
<DIV style="position:absolute;top:856;left:287"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:851;left:311"><nobr><span class="ft5">is empty. Each time</span></nobr></DIV>
<DIV style="position:absolute;top:866;left:81"><nobr><span class="ft10">an instruction PUSHALTS is executed (see trE definition<br>for case), the environment  the corresponding alterna-<br>tives are compiled with, is pushed onto stack S</span></nobr></DIV>
<DIV style="position:absolute;top:901;left:377"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:896;left:396"><nobr><span class="ft5">. Each</span></nobr></DIV>
<DIV style="position:absolute;top:911;left:81"><nobr><span class="ft5">time a RETURNCON pops a case pointer, stack S</span></nobr></DIV>
<DIV style="position:absolute;top:917;left:406"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:911;left:430"><nobr><span class="ft5">is</span></nobr></DIV>
<DIV style="position:absolute;top:926;left:81"><nobr><span class="ft10">also pop-ed. So, enriched ISTG configurations have the form<br>(is, , , S</span></nobr></DIV>
<DIV style="position:absolute;top:947;left:138"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:941;left:145"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:947;left:159"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:941;left:177"><nobr><span class="ft5">, node, </span></nobr></DIV>
<DIV style="position:absolute;top:947;left:226"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:941;left:233"><nobr><span class="ft5">, cs).</span></nobr></DIV>
<DIV style="position:absolute;top:982;left:96"><nobr><span class="ft5">Definition 6. A STG-2 environment E is equivalent to an</span></nobr></DIV>
<DIV style="position:absolute;top:997;left:81"><nobr><span class="ft5">ISTG environment defined by , , S</span></nobr></DIV>
<DIV style="position:absolute;top:1002;left:297"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:997;left:303"><nobr><span class="ft5">, </span></nobr></DIV>
<DIV style="position:absolute;top:1002;left:319"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:997;left:330"><nobr><span class="ft5">and node, denoted</span></nobr></DIV>
<DIV style="position:absolute;top:1012;left:81"><nobr><span class="ft5">E  (, S</span></nobr></DIV>
<DIV style="position:absolute;top:1017;left:137"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1012;left:143"><nobr><span class="ft5">, , </span></nobr></DIV>
<DIV style="position:absolute;top:1017;left:172"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1012;left:178"><nobr><span class="ft5">, node) if dom E  dom   dom  and</span></nobr></DIV>
<DIV style="position:absolute;top:1052;left:97"><nobr><span class="ft5">x  dom E</span></nobr></DIV>
<DIV style="position:absolute;top:1044;left:190"><nobr><span class="ft5">E x = S</span></nobr></DIV>
<DIV style="position:absolute;top:1049;left:241"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1044;left:251"><nobr><span class="ft5">! ( x)</span></nobr></DIV>
<DIV style="position:absolute;top:1044;left:339"><nobr><span class="ft5">if x  dom </span></nobr></DIV>
<DIV style="position:absolute;top:1059;left:190"><nobr><span class="ft5">E x = node</span></nobr></DIV>
<DIV style="position:absolute;top:1064;left:261"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:1068;left:268"><nobr><span class="ft14">I</span></nobr></DIV>
<DIV style="position:absolute;top:1059;left:278"><nobr><span class="ft5">! ( x)</span></nobr></DIV>
<DIV style="position:absolute;top:1059;left:339"><nobr><span class="ft5">if x  dom </span></nobr></DIV>
<DIV style="position:absolute;top:832;left:490"><nobr><span class="ft5">Definition 7. A STG-2 stack S is equivalent to a triple</span></nobr></DIV>
<DIV style="position:absolute;top:847;left:475"><nobr><span class="ft5">(, S</span></nobr></DIV>
<DIV style="position:absolute;top:852;left:502"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:847;left:509"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:852;left:523"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:847;left:541"><nobr><span class="ft5">) of an ISTG enriched configuration, denoted S </span></nobr></DIV>
<DIV style="position:absolute;top:862;left:475"><nobr><span class="ft5">(, S</span></nobr></DIV>
<DIV style="position:absolute;top:867;left:502"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:862;left:509"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:867;left:523"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:862;left:541"><nobr><span class="ft5">), if</span></nobr></DIV>
<DIV style="position:absolute;top:886;left:491"><nobr><span class="ft5">1. Whenever  = (, m, 0) :  , then S</span></nobr></DIV>
<DIV style="position:absolute;top:891;left:727"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:886;left:738"><nobr><span class="ft5">= a</span></nobr></DIV>
<DIV style="position:absolute;top:891;left:762"><nobr><span class="ft1">im</span></nobr></DIV>
<DIV style="position:absolute;top:886;left:782"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:892;left:800"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:886;left:812"><nobr><span class="ft5">and</span></nobr></DIV>
<DIV style="position:absolute;top:901;left:509"><nobr><span class="ft5">S  ( , S</span></nobr></DIV>
<DIV style="position:absolute;top:908;left:568"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:901;left:574"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:906;left:589"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:901;left:606"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:926;left:491"><nobr><span class="ft5">2. Whenever  = (, m, n) :  , n &gt; 0, then S = a</span></nobr></DIV>
<DIV style="position:absolute;top:931;left:792"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:926;left:809"><nobr><span class="ft5">: S ,</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:509"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:950;left:517"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:527"><nobr><span class="ft5">= a</span></nobr></DIV>
<DIV style="position:absolute;top:950;left:549"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:566"><nobr><span class="ft5">: b</span></nobr></DIV>
<DIV style="position:absolute;top:950;left:579"><nobr><span class="ft1">j</span></nobr></DIV>
<DIV style="position:absolute;top:940;left:585"><nobr><span class="ft1">m-n</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:615"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:951;left:631"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:642"><nobr><span class="ft5">and S  ( , S</span></nobr></DIV>
<DIV style="position:absolute;top:951;left:732"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:738"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:950;left:753"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:945;left:770"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:970;left:491"><nobr><span class="ft5">3. Whenever  = (, m, -1) :  , then S = (alts, E) : S ,</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:509"><nobr><span class="ft5">S</span></nobr></DIV>
<DIV style="position:absolute;top:990;left:517"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:527"><nobr><span class="ft5">= p</span></nobr></DIV>
<DIV style="position:absolute;top:990;left:549"><nobr><span class="ft1">alts</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:570"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:991;left:587"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:593"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:990;left:609"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:630"><nobr><span class="ft5">= </span></nobr></DIV>
<DIV style="position:absolute;top:990;left:651"><nobr><span class="ft1">alts</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:673"><nobr><span class="ft5">: S</span></nobr></DIV>
<DIV style="position:absolute;top:991;left:689"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:706"><nobr><span class="ft5">, p</span></nobr></DIV>
<DIV style="position:absolute;top:990;left:721"><nobr><span class="ft1">alts</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:742"><nobr><span class="ft5">= trAs alts </span></nobr></DIV>
<DIV style="position:absolute;top:990;left:819"><nobr><span class="ft1">alts</span></nobr></DIV>
<DIV style="position:absolute;top:985;left:837"><nobr><span class="ft5">,</span></nobr></DIV>
<DIV style="position:absolute;top:1000;left:509"><nobr><span class="ft5">E  (</span></nobr></DIV>
<DIV style="position:absolute;top:1005;left:551"><nobr><span class="ft1">alts</span></nobr></DIV>
<DIV style="position:absolute;top:1000;left:568"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:1006;left:583"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1000;left:589"><nobr><span class="ft5">, , , ) and S  (</span></nobr></DIV>
<DIV style="position:absolute;top:1005;left:713"><nobr><span class="ft1">alts</span></nobr></DIV>
<DIV style="position:absolute;top:1000;left:730"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:1006;left:745"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1000;left:751"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:1006;left:766"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:1000;left:783"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:1025;left:491"><nobr><span class="ft5">4. Whenever S = #a : S and S</span></nobr></DIV>
<DIV style="position:absolute;top:1030;left:690"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1025;left:701"><nobr><span class="ft5">= #a : S</span></nobr></DIV>
<DIV style="position:absolute;top:1031;left:758"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1025;left:764"><nobr><span class="ft5">, then S </span></nobr></DIV>
<DIV style="position:absolute;top:1040;left:509"><nobr><span class="ft5">(, S</span></nobr></DIV>
<DIV style="position:absolute;top:1046;left:536"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:1040;left:542"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:1045;left:557"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:1040;left:574"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:1065;left:491"><nobr><span class="ft5">5. Additionally, [ ]  ({}, [ ], [ ])</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">110</span></nobr></DIV>
</DIV>
<!-- Page 10 -->
<a name="10"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
	.ft15{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</STYLE>
<IMG width="918" height="1188" src="95010.png" alt="background image">
<DIV style="position:absolute;top:84;left:96"><nobr><span class="ft5">Definition 8. A STG-2 heap  is equivalent to an ISTG</span></nobr></DIV>
<DIV style="position:absolute;top:99;left:81"><nobr><span class="ft5">pair (</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:122"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:99;left:128"><nobr><span class="ft5">, cs), denoted   (</span></nobr></DIV>
<DIV style="position:absolute;top:105;left:253"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:99;left:259"><nobr><span class="ft5">, cs), if for all p we have [p </span></nobr></DIV>
<DIV style="position:absolute;top:117;left:81"><nobr><span class="ft5">(lf |</span></nobr></DIV>
<DIV style="position:absolute;top:115;left:105"><nobr><span class="ft1">x</span></nobr></DIV>
<DIV style="position:absolute;top:118;left:112"><nobr><span class="ft14">in</span></nobr></DIV>
<DIV style="position:absolute;top:117;left:124"><nobr><span class="ft5">, E)] if and only if </span></nobr></DIV>
<DIV style="position:absolute;top:122;left:249"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:117;left:256"><nobr><span class="ft5">[p  (q, ws)], cs[q  is], is =</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:81"><nobr><span class="ft5">trB (lf |</span></nobr></DIV>
<DIV style="position:absolute;top:132;left:130"><nobr><span class="ft1">x</span></nobr></DIV>
<DIV style="position:absolute;top:136;left:137"><nobr><span class="ft14">in</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:150"><nobr><span class="ft5">) and ws = E x</span></nobr></DIV>
<DIV style="position:absolute;top:140;left:244"><nobr><span class="ft1">i</span></nobr></DIV>
<DIV style="position:absolute;top:130;left:249"><nobr><span class="ft1">n</span></nobr></DIV>
<DIV style="position:absolute;top:134;left:257"><nobr><span class="ft5">.</span></nobr></DIV>
<DIV style="position:absolute;top:162;left:96"><nobr><span class="ft5">Definition 9. A STG-2 configuration is equivalent to an</span></nobr></DIV>
<DIV style="position:absolute;top:177;left:81"><nobr><span class="ft10">ISTG enriched stable configuration, denoted (, e, E, S) <br>(is, , , S</span></nobr></DIV>
<DIV style="position:absolute;top:198;left:138"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:145"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:198;left:159"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:178"><nobr><span class="ft5">, node, </span></nobr></DIV>
<DIV style="position:absolute;top:198;left:228"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:192;left:234"><nobr><span class="ft5">, cs) if</span></nobr></DIV>
<DIV style="position:absolute;top:217;left:97"><nobr><span class="ft5">1.   (</span></nobr></DIV>
<DIV style="position:absolute;top:223;left:155"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:217;left:162"><nobr><span class="ft5">, cs)</span></nobr></DIV>
<DIV style="position:absolute;top:243;left:97"><nobr><span class="ft5">2. is = trE e  </span></nobr></DIV>
<DIV style="position:absolute;top:268;left:97"><nobr><span class="ft5">3. E  (, S</span></nobr></DIV>
<DIV style="position:absolute;top:274;left:171"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:268;left:177"><nobr><span class="ft5">, , </span></nobr></DIV>
<DIV style="position:absolute;top:274;left:205"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:268;left:212"><nobr><span class="ft5">, node)</span></nobr></DIV>
<DIV style="position:absolute;top:294;left:97"><nobr><span class="ft5">4. S  (, S</span></nobr></DIV>
<DIV style="position:absolute;top:299;left:169"><nobr><span class="ft1">I</span></nobr></DIV>
<DIV style="position:absolute;top:294;left:175"><nobr><span class="ft5">, S</span></nobr></DIV>
<DIV style="position:absolute;top:299;left:190"><nobr><span class="ft1">env</span></nobr></DIV>
<DIV style="position:absolute;top:294;left:207"><nobr><span class="ft5">)</span></nobr></DIV>
<DIV style="position:absolute;top:322;left:96"><nobr><span class="ft5">Proposition 9. (dynamic invariant) Given a closed ex-</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:81"><nobr><span class="ft5">pression e</span></nobr></DIV>
<DIV style="position:absolute;top:342;left:142"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:153"><nobr><span class="ft5">with different bound variables and initial STG-</span></nobr></DIV>
<DIV style="position:absolute;top:352;left:81"><nobr><span class="ft5">2 and ISTG configurations, respectively ({}, e</span></nobr></DIV>
<DIV style="position:absolute;top:357;left:362"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:352;left:368"><nobr><span class="ft5">, {}, [ ]) and</span></nobr></DIV>
<DIV style="position:absolute;top:367;left:81"><nobr><span class="ft5">(trE e</span></nobr></DIV>
<DIV style="position:absolute;top:372;left:121"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:367;left:134"><nobr><span class="ft5"></span></nobr></DIV>
<DIV style="position:absolute;top:373;left:141"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:367;left:153"><nobr><span class="ft5">{}, </span></nobr></DIV>
<DIV style="position:absolute;top:373;left:180"><nobr><span class="ft1"></span></nobr></DIV>
<DIV style="position:absolute;top:367;left:187"><nobr><span class="ft5">, {}, [ ], [ ], , {}, cs), where cs is the code</span></nobr></DIV>
<DIV style="position:absolute;top:382;left:81"><nobr><span class="ft5">store generated by the whole translation of e</span></nobr></DIV>
<DIV style="position:absolute;top:387;left:342"><nobr><span class="ft1">0</span></nobr></DIV>
<DIV style="position:absolute;top:382;left:349"><nobr><span class="ft5">, then both ma-</span></nobr></DIV>
<DIV style="position:absolute;top:397;left:81"><nobr><span class="ft5">chines evolve through equivalent configurations.</span></nobr></DIV>
<DIV style="position:absolute;top:420;left:96"><nobr><span class="ft5">Proof. By induction on the number of transitions of</span></nobr></DIV>
<DIV style="position:absolute;top:435;left:81"><nobr><span class="ft10">both machines. Only transitions between ISTG stable con-<br>figurations are considered.</span></nobr></DIV>
<DIV style="position:absolute;top:478;left:96"><nobr><span class="ft5">Corollary 10. The translation given in Section 5.1 is</span></nobr></DIV>
<DIV style="position:absolute;top:493;left:81"><nobr><span class="ft5">correct.</span></nobr></DIV>
<DIV style="position:absolute;top:528;left:81"><nobr><span class="ft4"><b>6.</b></span></nobr></DIV>
<DIV style="position:absolute;top:528;left:112"><nobr><span class="ft12"><b>DIFFERENCES WITH THE ACTUAL STG<br>MACHINE</b></span></nobr></DIV>
<DIV style="position:absolute;top:567;left:94"><nobr><span class="ft5">There are some differences between the machine transla-</span></nobr></DIV>
<DIV style="position:absolute;top:582;left:81"><nobr><span class="ft10">tion presented in Section 5 and the actual code generated<br>by GHC. Some are just omissions, other are non-substantial<br>differences and some other are deeper ones.</span></nobr></DIV>
<DIV style="position:absolute;top:628;left:94"><nobr><span class="ft5">In the first group it is the treatment of basic values, very</span></nobr></DIV>
<DIV style="position:absolute;top:643;left:81"><nobr><span class="ft10">elaborated in GHC (see for example [3]) and completely ig-<br>nored here. We have preferred to concentrate our study in<br>the functional kernel of the machine but, of course, a formal<br>reasoning about this aspect is a clear continuation of our<br>work.</span></nobr></DIV>
<DIV style="position:absolute;top:718;left:94"><nobr><span class="ft5">In the second group it is the optimization of update im-</span></nobr></DIV>
<DIV style="position:absolute;top:733;left:81"><nobr><span class="ft10">plementation. In GHC, updates can be done either by indi-<br>rection or by closure creation, depending on whether there<br>is enough space or not in the old closure to do update in<br>place. This implies to keep closure size information some-<br>where. GHC keeps it in the so called info table, a static part<br>shared by all closures created from the same bind. This<br>table forces an additional indirection to access the closure<br>code. Our model has simplified these aspects. We under-<br>stand also that stack restructuring, as the one performed by<br>our SLIDE instruction, is not implemented in this way by<br>GHC. Apparently, stubbing of non used stack positions is<br>done instead. An efficiency study could show which imple-<br>mentation is better. The cost of our SLIDE instruction is<br>in O(n), being n the number of arguments to be preserved<br>in the stack when the current environment is discarded.</span></nobr></DIV>
<DIV style="position:absolute;top:959;left:94"><nobr><span class="ft5">Perhaps the deeper difference between our derived ma-</span></nobr></DIV>
<DIV style="position:absolute;top:974;left:81"><nobr><span class="ft10">chine and the actual STG is our insistence in that FUN ap-<br>plications should have the form e x</span></nobr></DIV>
<DIV style="position:absolute;top:995;left:288"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:989;left:304"><nobr><span class="ft5">instead of x x</span></nobr></DIV>
<DIV style="position:absolute;top:995;left:385"><nobr><span class="ft1">in</span></nobr></DIV>
<DIV style="position:absolute;top:989;left:401"><nobr><span class="ft5">as it is</span></nobr></DIV>
<DIV style="position:absolute;top:1004;left:81"><nobr><span class="ft10">the case in the STG language. This decision is not justified<br>in the GHC papers and perhaps could have a noticeable neg-<br>ative impact in performance. In a lazy language, the func-<br>tional part of an application should be eagerly evaluated,<br>but GHC does it lazily. This implies constructing a number</span></nobr></DIV>
<DIV style="position:absolute;top:84;left:475"><nobr><span class="ft10">of closures that will be immediately entered (and perhaps<br>updated afterwards), with a corresponding additional cost<br>both in space and time. Our translation avoids creating and<br>entering these closures. If the counter-argument were hav-<br>ing the possibility of sharing functional expressions, this is<br>always available in FUN since a variable is a particular case<br>of an expression. What we claim is that the normalization<br>process in the Core-to-STG translation should not introduce<br>unneeded sharing.</span></nobr></DIV>
<DIV style="position:absolute;top:243;left:475"><nobr><span class="ft4"><b>7.</b></span></nobr></DIV>
<DIV style="position:absolute;top:243;left:507"><nobr><span class="ft4"><b>CONCLUSIONS</b></span></nobr></DIV>
<DIV style="position:absolute;top:261;left:489"><nobr><span class="ft5">We have presented a stepwise derivation of a (well known)</span></nobr></DIV>
<DIV style="position:absolute;top:277;left:475"><nobr><span class="ft10">abstract machine starting from Sestoft's operational seman-<br>tics, going through several intermediate machines and arriv-<br>ing at an imperative machine very close to a conventional im-<br>perative language. This strategy of adding a small amount<br>of detail in each step has allowed us both to provide in-<br>sight on fundamental decisions underlying the STG design<br>and, perhaps more importantly, to be able to show the cor-<br>rectness of each refinement with respect to the previous one<br>and, consequently, the correctness of the whole derivation.<br>To our knowledge, this is the first time that formal transla-<br>tion schemes and a formal proof of correctness of the STG<br>to C translation has been done.</span></nobr></DIV>
<DIV style="position:absolute;top:457;left:489"><nobr><span class="ft5">Our previous work [2] followed a different path: it showed</span></nobr></DIV>
<DIV style="position:absolute;top:472;left:475"><nobr><span class="ft10">the soundness and completeness of a STG-like machine called<br>STG-1S (laying somewhere between machines STG-2 and<br>ISTG of this paper) with respect to Sestoft's semantics.<br>The technique used was also different: a bisimulation be-<br>tween the STG-1S machine and Sestoft's MARK-2 machine<br>was proved. We got the inspiration for the strategy followed<br>here from Mountjoy [5] and in Section 2 we have explained<br>the differences between his and our work. The previous ma-<br>chines of all these works, including STG-1 and STG-2 of this<br>paper, are very abstract in the sense that they deal directly<br>with functional expressions. The new machine ISTG intro-<br>duced here is a really low level machine dealing with raw<br>imperative instructions and pointers. Two contributions of<br>this paper have been to bridge this big gap by means of<br>the translations schemes and the proof of correctness of this<br>translation.</span></nobr></DIV>
<DIV style="position:absolute;top:713;left:489"><nobr><span class="ft5">Our experience is that formal reasoning about even well</span></nobr></DIV>
<DIV style="position:absolute;top:728;left:475"><nobr><span class="ft10">known products always reveals new details, give new insight,<br>makes good decisions more solid and provides trust in the<br>behavior of our programs.</span></nobr></DIV>
<DIV style="position:absolute;top:796;left:475"><nobr><span class="ft4"><b>8.</b></span></nobr></DIV>
<DIV style="position:absolute;top:796;left:507"><nobr><span class="ft4"><b>REFERENCES</b></span></nobr></DIV>
<DIV style="position:absolute;top:818;left:482"><nobr><span class="ft15">[1] A. at URL: http://www.haskell.org/ghc/.<br>[2] A. Encina and R. Pe~</span></nobr></DIV>
<DIV style="position:absolute;top:834;left:629"><nobr><span class="ft5">na. Proving the Correctness of</span></nobr></DIV>
<DIV style="position:absolute;top:849;left:503"><nobr><span class="ft10">the STG Machine. In Implementation of Functional<br>Languages, IFL'01. Selected Papers. LNCS 2312,<br>pages 88­104. Springer-Verlag, 2002.</span></nobr></DIV>
<DIV style="position:absolute;top:896;left:482"><nobr><span class="ft5">[3] S. P. Jones and J. Launchbury. Unboxed values as first</span></nobr></DIV>
<DIV style="position:absolute;top:911;left:503"><nobr><span class="ft10">class citizens in a non-strict functional language.<br>Conference on Functional Programming Languages<br>and Computer Architecture FPCA'91, LNCS 523,<br>September 1991.</span></nobr></DIV>
<DIV style="position:absolute;top:973;left:482"><nobr><span class="ft5">[4] J. Launchbury. A Natural Semantics for Lazy</span></nobr></DIV>
<DIV style="position:absolute;top:988;left:503"><nobr><span class="ft10">Evaluation. In Proc. Conference on Principles of<br>Programming Languages, POPL'93. ACM, 1993.</span></nobr></DIV>
<DIV style="position:absolute;top:1019;left:482"><nobr><span class="ft5">[5] J. Mountjoy. The Spineless Tagless G-machine,</span></nobr></DIV>
<DIV style="position:absolute;top:1034;left:503"><nobr><span class="ft10">Naturally. In Third International Conference on<br>Functional Programming, ICFP'98, Baltimore. ACM<br>Press, 1998.</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">111</span></nobr></DIV>
</DIV>
<!-- Page 11 -->
<a name="11"></a>
<DIV style="position:relative;width:918;height:1188;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="918" height="1188" src="95011.png" alt="background image">
<DIV style="position:absolute;top:84;left:88"><nobr><span class="ft5">[6] S. L. Peyton Jones. Implementing Lazy Functional</span></nobr></DIV>
<DIV style="position:absolute;top:99;left:109"><nobr><span class="ft10">Languages on Stock Hardware: the Spineless Tagless<br>G-machine, Version 2.5. Journal of Functional<br>Programming, 2(2):127­202, April 1992.</span></nobr></DIV>
<DIV style="position:absolute;top:146;left:88"><nobr><span class="ft5">[7] S. L. Peyton Jones, C. V. Hall, K. Hammond, W. D.</span></nobr></DIV>
<DIV style="position:absolute;top:161;left:109"><nobr><span class="ft10">Partain, and P. L. Wadler. The Glasgow Haskell<br>Compiler: A Technical Overview. In Joint Framework<br>for Inf. Technology, Keele, pages 249­257, 1993.</span></nobr></DIV>
<DIV style="position:absolute;top:84;left:482"><nobr><span class="ft5">[8] S. L. Peyton Jones and J. Hughes, editors. Report on</span></nobr></DIV>
<DIV style="position:absolute;top:99;left:503"><nobr><span class="ft10">the Programming Language Haskell 98. URL<br>http://www.haskell.org, February 1999.</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:482"><nobr><span class="ft5">[9] S. L. Peyton Jones, S. Marlow, and A. Reid. The STG</span></nobr></DIV>
<DIV style="position:absolute;top:146;left:503"><nobr><span class="ft10">Runtime System (revised).<br>http://www.haskell.org/ghc/docs, 1999.</span></nobr></DIV>
<DIV style="position:absolute;top:178;left:475"><nobr><span class="ft5">[10] P. Sestoft. Deriving a Lazy Abstract Machine. Journal</span></nobr></DIV>
<DIV style="position:absolute;top:193;left:503"><nobr><span class="ft5">of Functional Programming, 7(3):231­264, May 1997.</span></nobr></DIV>
<DIV style="position:absolute;top:1128;left:449"><nobr><span class="ft9">112</span></nobr></DIV>
</DIV>
</BODY>
</HTML>
